const translationsStrings = {
	phoneCode: {
		cs: "+420 ",
		sk: "+421 ",
		pl: "+48 ",
	},
	contactHours: {
		cs: "Po–Pá 8:00–16:00",
		sk: "Po–Pá 8:00–16:00",
		pl: "Pn–Pt 8:00–16:00",
	},
	showAllCategories: {
		cs: "Zobrazit další kategorie",
		sk: "Zobraziť ďalšie kategórie",
		pl: "Pokaż więcej kategorii",
	},
	moreButtonMoreThanFour: {
		cs: "dalších ",
		sk: "ďalších ",
		pl: "dalszych ",
	},
	moreButtonLessThanFour: {
		cs: "další ",
		sk: "ďalšie ",
		pl: "dalsze ",
	},
	more: {
		cs: "Více",
		sk: "Viac",
		pl: "Więcej",
	},
	moreThan: {
		cs: "více než ",
		sk: "viac ako ",
		pl: "więcej niż ",
	},
	cartTotalLabel: {
		cs: "Cena celkem",
		sk: "Cena spolu",
		pl: "Cena łącznie",
	},
	customFilterButton: {
		cs: "Filtrování výsledků",
		sk: "Filtrovanie výsledkov",
		pl: "Filtrowanie wyników",
	},
	selectedFilters: {
		cs: "Vybrané filtry",
		sk: "Vybrané filtre",
		pl: "Wybrane filtry",
	},
	product: {
		cs: "Produkt",
		sk: "Produkt",
		pl: "Produkt",
	},
	verifiedReviews: {
		cs: "Ověřená hodnocení",
		sk: "Overené hodnotenia",
		pl: "Zweryfikowane opinie",
	},
	shopRatingUrl: {
		cs: "/hodnoceni-obchodu",
		sk: "/hodnotenie-obchodu",
		pl: "/opinie-o-sklepie",
	},
	noSaleCoupon: {
		cs: "U tohoto produktu není možné uplatnit slevový kód.",
		sk: "U tohto produktu nie je možné uplatniť zľavový kód.",
		pl: "U tego produktu nie można zastosować kodu rabatowego.",
	},
	noLoyaltySale: {
		cs: "U tohoto produktu není možné uplatnit věrnostní slevu.",
		sk: "U tohto produktu nie je možné uplatniť vernostnú zľavu.",
		pl: "U tego produktu nie można zastosować zniżki lojalnościowej.",
	},
	descriptionTitle: {
		cs: "Popis",
		sk: "Popis",
		pl: "Opis",
	},
	directionsTitle: {
		cs: "Dávkování",
		sk: "Dávkovanie",
		pl: "Dawkowanie",
	},
	ingredientsTitle: {
		cs: "Složení",
		sk: "Zloženie",
		pl: "Skład",
	},
	certificatesTitle: {
		cs: "Certifikáty",
		sk: "Certifikáty",
		pl: "Certyfikaty",
	},
	reviewsTitle: {
		cs: "Hodnocení",
		sk: "Hodnotenie",
		pl: "Opinie",
	},
	weSupportTitle: {
		cs: "Pomáháme",
		sk: "Pomáhame",
		pl: "Pomagamy",
	},
	relatedProductsTitle: {
		cs: "Související produkty",
		sk: "Súvisiace produkty",
		pl: "Produkty powiązane",
	},
	showRelatedProducts: {
		cs: "Zobrazit související produkty",
		sk: "Zobraziť súvisiace produkty",
		pl: "Pokaż produkty powiązane",
	},
	relatedFilesTitle: {
		cs: "Dokumenty",
		sk: "Dokumenty",
		pl: "Dokumenty",
	},
	show: {
		cs: "Zobrazit",
		sk: "Zobraziť",
		pl: "Pokaż",
	},
	showCertificate: {
		cs: "Zobrazit certifikát",
		sk: "Zobraziť certifikát",
		pl: "Pokaż certyfikat",
	},
	outOf: {
		cs: "z",
		sk: "z",
		pl: "z",
	},
	natiosDescription: {
		cs: "Natios je česká značka, která se zaměřuje na výrobu kvalitních doplňků stravy s čistým složením bez zbytečných příměsí, konzervantů a éček.",
		sk: "Natios je česká značka, ktorá sa zameriava na výrobu kvalitných doplnkov stravy s čistým zložením bez zbytočných prísad, konzervantov a éčok.",
		pl: "Natios to czeska marka, która koncentruje się na produkcji wysokiej jakości suplementów diety o czystym składzie – bez zbędnych domieszek, konserwantów i sztucznych dodatków (E).",
	},

	natiosSupportTextTop: {
		cs: "Nákupem <b>přispějete</b> 1 Kč dětské hematoonkologii.",
		sk: "Nákupom <b>prispievate</b> 1 Kč detskej hematoonkológii.",
		pl: "Kupując, <b>wspierasz</b> dziecięcą hematoonkologię kwotą 1 CZK.",
	},
	natiosSupportHeaderBottom: {
		cs: "<h3>Pomáháme</h3><span>&nbsp;dětské hematoonkologii</span>",
		sk: "<h3>Pomáhame</h3><span>&nbsp;detskej hematoonkológii</span>",
		pl: "<h3>Pomagamy</h3><span>&nbsp;pediatrycznej hematoonkologii</span>",
	},
	natiosSupportTextBottom: {
		cs: "Natios z každého prodaného produktu daruje 1 Kč dětské hematoonkologii ve Fakultní nemocnici v Ostravě. Léčba každého onkologického pacienta v České republice se odhaduje na přibližně 8&nbsp;000&nbsp;Kč měsíčně. Věříme tedy, že tímto krokem společně dokážeme pomoci několika rodinám.",
		sk: "Natios z každého predaného produktu daruje 1 Kč detskej hematoonkológii vo Fakultnej nemocnici v Ostrave. Liečba každého onkologického pacienta v České republice sa odhaduje na približne 8&nbsp;000&nbsp;Kč mesačne. Veríme teda, že týmto krokom spoločne dokážeme pomôcť niekoľkým rodinám.",
		pl: "Natios z każdego sprzedanego produktu przekazuje 1 CZK na rzecz pediatrycznej hematoonkologii w Szpitalu Uniwersyteckim w Ostrawie. Leczenie jednego pacjenta onkologicznego w Czechach szacuje się na około 8&nbsp;000&nbsp;CZK miesięcznie. Wierzymy, że tym krokiem wspólnie możemy pomóc wielu rodzinom.",
	},
	natiosSupportTotalAmount: {
		cs: "Společně jsme již dokázali přispět přes 650&nbsp;000&nbsp;Kč. Děkujeme!",
		sk: "Spoločne sme už dokázali prispieť cez 650&nbsp;000&nbsp;Kč. Ďakujeme!",
		pl: "Wspólnie udało nam się już przekazać ponad 650&nbsp;000&nbsp;CZK. Dziękujemy!",
	},
	natiosSupportBlogUrl: {
		cs: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		sk: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		pl: "/",
	},
	moreAboutSupport: {
		cs: "Více o pomoci",
		sk: "Viac o pomoci",
		pl: "Więcej o pomocy",
	},
	insertFirstReview: {
		cs: "Vložit první hodnocení",
		sk: "Vložiť prvé hodnotenie",
		pl: "Wstaw pierwszą opinię",
	},
	watchDog: {
		cs: "Hlídat dostupnost",
		sk: "Strážiť dostupnosť",
		pl: "Obserwuj dostępność",
	},
	readMore: {
		cs: "Číst dále",
		sk: "Čítať ďalej",
		pl: "Czytaj dalej",
	},
	productVariants: {
		cs: "Varianty produktu",
		sk: "Varianty produktu",
		pl: "Warianty produktu",
	},
	showMoreVariants: {
		cs: "Zobrazit více variant",
		sk: "Zobraziť viac variantov",
		pl: "Pokaż więcej wariantów",
	},
	withVAT: {
		cs: "s DPH",
		sk: "s DPH",
		pl: "z VAT",
	},
	toCart: {
		cs: "Do košíku",
		sk: "Do košíka",
		pl: "Do koszyka",
	},
	alertMe: {
		cs: "Upozornit",
		sk: "Upozorniť",
		pl: "Powiadom",
	},
	/* 	gitFiltersUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_pl.json",
	},
	gitHeurekaReviewsUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/data/ceneo_reviews_pl.json" 
	}, */
};

/*--------------------------------------- Přepsání funkcí*/
function moveFilters() {}

/*-------------------------------------- Custom events*/
// Debounce function to limit the rate at which a function can fire
let resizeTimer;
let lastWindowWidth = window.innerWidth;

window.addEventListener("resize", function () {
	if (window.innerWidth !== lastWindowWidth) {
		document.dispatchEvent(new CustomEvent("resizeX"));

		clearTimeout(resizeTimer);
		resizeTimer = setTimeout(function () {
			lastWindowWidth = window.innerWidth;
			// Dispatch a custom event when X axis resize is complete
			console.log("CUSTOM EVENT DISPATCHED: debouncedResize");
			document.dispatchEvent(new CustomEvent("debouncedResize"));
		}, 250);
	}
});

/*-------------------------------------- Media sizes*/
const mediaSizes = {
	desktop: 1280,
	tablet: 768,
};
let isMobile = false;
let isTablet = false;
let isDesktop = false;

let body = document.querySelector("body");

function checkMediaSizes() {
	if (window.innerWidth < mediaSizes.tablet) {
		isMobile = true;
		isTablet = false;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.tablet && window.innerWidth < mediaSizes.desktop) {
		isMobile = false;
		isTablet = true;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.desktop) {
		isMobile = false;
		isTablet = false;
		isDesktop = true;
	}
}

checkMediaSizes();
document.addEventListener("resizeX", function () {
	checkMediaSizes();
});

function scrollToElement(element) {
	const headerHeight = document.querySelector("#header").offsetHeight;
	window.scrollTo({
		top: element.getBoundingClientRect().top + window.pageYOffset - headerHeight,
		behavior: "smooth",
	});
}

/*-------------------------------------- MENU OVERFLOW DETECTION*/
let menuLevelOne = document.querySelector(".menu-level-1");

function createMenuHelper() {
	if (document.querySelector(".menu-helper-custom")) {
		return;
	}
	const menuHelperCustom = document.createElement("div");
	menuHelperCustom.className = "menu-helper-custom";

	const menuHelperCustomText = document.createElement("span");
	menuHelperCustom.appendChild(menuHelperCustomText);
	menuHelperCustomText.textContent = translationsStrings.more[activeLang];

	const menuHelperCustomSubmenu = document.createElement("ul");
	menuHelperCustomSubmenu.className = "menu-helper-custom-submenu";
	menuHelperCustom.appendChild(menuHelperCustomSubmenu);

	if (menuLevelOne) {
		menuLevelOne.appendChild(menuHelperCustom);
	}
}

function inicializeMenu() {
	createMenuHelper();
	let menuHelperCustom = document.querySelector(".menu-helper-custom");
	let menuHelperCustomSubmenu = menuHelperCustom.querySelector(".menu-helper-custom-submenu");
	if (!menuLevelOne || !menuHelperCustom || !menuHelperCustomSubmenu) {
		return;
	}

	if (isMobile) {
		let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
		for (let i = 0; i < menuLevelOneLis.length; i++) {
			menuHelperCustomSubmenu.prepend(menuLevelOneLis[menuLevelOneLis.length - 1 - i]);
		}
		menuHelperCustom.classList.add("active");
		return;
	}

	/*Initial state*/
	menuHelperCustom.classList.remove("active");
	menuHelperCustomSubmenu.querySelectorAll(":scope>li").forEach((li) => {
		menuLevelOne.appendChild(li);
	});
	menuLevelOne.appendChild(menuHelperCustom);
	let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
	let overflownItems = false;
	let overflownIndex = -1;
	const menuLevelOneWidth = menuLevelOne.offsetWidth;
	const menuHelperCustomWidth = menuHelperCustom.offsetWidth;
	let cumulativeWidth = 0;

	//Detect overflown items
	for (let i = 0; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		cumulativeWidth += li.offsetWidth;
		if (cumulativeWidth > menuLevelOneWidth) {
			overflownItems = true;
			overflownIndex = i;
			break;
		}
	}

	if (!overflownItems) {
		return;
	}

	//calculate if helper fits
	cumulativeWidth = menuHelperCustomWidth + cumulativeWidth;
	if (cumulativeWidth > menuLevelOneWidth) {
		overflownIndex = overflownIndex - 1;
	}

	//move overflown items to helper
	for (let i = overflownIndex; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		menuHelperCustomSubmenu.appendChild(li);
	}
	menuHelperCustom.classList.add("active");
}

/*Edit menu-level-2 href and img*/
function editMenuLevel2() {
	let menusLevel2 = document.querySelectorAll("#header .menu-level-2");
	if (!menusLevel2 || menusLevel2.length === 0) {
		return;
	}

	menusLevel2.forEach((menu) => {
		let childrenLi = menu.querySelectorAll(":scope>li");
		if (!childrenLi || childrenLi.length === 0) {
			return;
		}
		childrenLi.forEach((li) => {
			let img = li.querySelector(":scope>a>img");
			if (img) {
				li.prepend(img);
			}
		});
	});
}

/*Move cart next to menu*/
function moveCartNextToMenu() {
	let cart = document.querySelector("#header .navigation-buttons");
	let navigation = document.querySelector("#header #navigation");
	if (cart && navigation) {
		navigation.appendChild(cart);
	}
}

document.addEventListener("DOMContentLoaded", function () {
	moveCartNextToMenu();
	inicializeMenu();
	editMenuLevel2();
});

document.addEventListener("debouncedResize", function () {
	inicializeMenu();
});
