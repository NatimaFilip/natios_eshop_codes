// AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
// This file is automatically generated by build-js.js
// Run 'npm run dev:js' or 'npm run build:js' to regenerate

(function() {
  'use strict';

  // ========================================
  // GLOBAL VARIABLES & CONFIGURATION
  // ========================================
  // From: js/0_global/media_size.js
const mediaSizes = {
	desktop: 1280,
	tablet: 768,
};
let isMobile = false;
let isTablet = false;
let isDesktop = false;

checkMediaSizes();
document.addEventListener("resizeX", function () {
	checkMediaSizes();
});

function checkMediaSizes() {
	if (window.innerWidth < mediaSizes.tablet) {
		isMobile = true;
		isTablet = false;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.tablet && window.innerWidth < mediaSizes.desktop) {
		isMobile = false;
		isTablet = true;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.desktop) {
		isMobile = false;
		isTablet = false;
		isDesktop = true;
	}
}


  // From: js/0_global/translations.js
const translationsStrings = {
	phoneCode: {
		cs: "+420 ",
		sk: "+421 ",
		pl: "+48 ",
	},
	contactHours: {
		cs: "Po–Pá 8:00–16:00",
		sk: "Po–Pá 8:00–16:00",
		pl: "Pn–Pt 8:00–16:00",
	},
	showAllCategories: {
		cs: "Zobrazit další kategorie",
		sk: "Zobraziť ďalšie kategórie",
		pl: "Pokaż więcej kategorii",
	},
	moreButtonMoreThanFour: {
		cs: "dalších ",
		sk: "ďalších ",
		pl: "dalszych ",
	},
	moreButtonLessThanFour: {
		cs: "další ",
		sk: "ďalšie ",
		pl: "dalsze ",
	},
	more: {
		cs: "Více",
		sk: "Viac",
		pl: "Więcej",
	},
	moreThan: {
		cs: "více než ",
		sk: "viac ako ",
		pl: "więcej niż ",
	},
	cartTotalLabel: {
		cs: "Cena celkem",
		sk: "Cena spolu",
		pl: "Cena łącznie",
	},
	customFilterButton: {
		cs: "Filtrování výsledků",
		sk: "Filtrovanie výsledkov",
		pl: "Filtrowanie wyników",
	},
	selectedFilters: {
		cs: "Vybrané filtry",
		sk: "Vybrané filtre",
		pl: "Wybrane filtry",
	},
	product: {
		cs: "Produkt",
		sk: "Produkt",
		pl: "Produkt",
	},
	favorites: {
		cs: "Oblíbené",
		sk: "Obľúbené",
		pl: "Ulubione",
	},
	compare: {
		cs: "Porovnat",
		sk: "Porovnať",
		pl: "Porównaj",
	},

	verifiedReviews: {
		cs: "Ověřená hodnocení",
		sk: "Overené hodnotenia",
		pl: "Zweryfikowane opinie",
	},
	shopRatingUrl: {
		cs: "/hodnoceni-obchodu",
		sk: "/hodnotenie-obchodu",
		pl: "/opinie-o-sklepie",
	},
	noSaleCoupon: {
		cs: "U tohoto produktu není možné uplatnit slevový kód.",
		sk: "U tohto produktu nie je možné uplatniť zľavový kód.",
		pl: "U tego produktu nie można zastosować kodu rabatowego.",
	},
	noLoyaltySale: {
		cs: "U tohoto produktu není možné uplatnit věrnostní slevu.",
		sk: "U tohto produktu nie je možné uplatniť vernostnú zľavu.",
		pl: "U tego produktu nie można zastosować zniżki lojalnościowej.",
	},
	descriptionTitle: {
		cs: "Popis",
		sk: "Popis",
		pl: "Opis",
	},
	directionsTitle: {
		cs: "Dávkování",
		sk: "Dávkovanie",
		pl: "Dawkowanie",
	},
	ingredientsTitle: {
		cs: "Složení",
		sk: "Zloženie",
		pl: "Skład",
	},
	certificatesTitle: {
		cs: "Certifikáty",
		sk: "Certifikáty",
		pl: "Certyfikaty",
	},
	reviewsTitle: {
		cs: "Hodnocení",
		sk: "Hodnotenie",
		pl: "Opinie",
	},
	weSupportTitle: {
		cs: "Pomáháme",
		sk: "Pomáhame",
		pl: "Pomagamy",
	},
	relatedProductsTitle: {
		cs: "Související produkty",
		sk: "Súvisiace produkty",
		pl: "Produkty powiązane",
	},
	showRelatedProducts: {
		cs: "Zobrazit související produkty",
		sk: "Zobraziť súvisiace produkty",
		pl: "Pokaż produkty powiązane",
	},
	relatedFilesTitle: {
		cs: "Dokumenty",
		sk: "Dokumenty",
		pl: "Dokumenty",
	},
	show: {
		cs: "Zobrazit",
		sk: "Zobraziť",
		pl: "Pokaż",
	},
	showCertificate: {
		cs: "Zobrazit certifikát",
		sk: "Zobraziť certifikát",
		pl: "Pokaż certyfikat",
	},
	outOf: {
		cs: "z",
		sk: "z",
		pl: "z",
	},
	natiosDescription: {
		cs: "Natios je česká značka, která se zaměřuje na výrobu kvalitních doplňků stravy s čistým složením bez zbytečných příměsí, konzervantů a éček.",
		sk: "Natios je česká značka, ktorá sa zameriava na výrobu kvalitných doplnkov stravy s čistým zložením bez zbytočných prísad, konzervantov a éčok.",
		pl: "Natios to czeska marka, która koncentruje się na produkcji wysokiej jakości suplementów diety o czystym składzie – bez zbędnych domieszek, konserwantów i sztucznych dodatków (E).",
	},

	natiosSupportTextTop: {
		cs: "Nákupem <b>přispějete</b> 1 Kč dětské hematoonkologii.",
		sk: "Nákupom <b>prispievate</b> 1 Kč detskej hematoonkológii.",
		pl: "Kupując, <b>wspierasz</b> dziecięcą hematoonkologię kwotą 1 CZK.",
	},
	natiosSupportHeaderBottom: {
		cs: "<h3>Pomáháme</h3><span>&nbsp;dětské hematoonkologii</span>",
		sk: "<h3>Pomáhame</h3><span>&nbsp;detskej hematoonkológii</span>",
		pl: "<h3>Pomagamy</h3><span>&nbsp;pediatrycznej hematoonkologii</span>",
	},
	natiosSupportTextBottom: {
		cs: "Natios z každého prodaného produktu daruje 1 Kč dětské hematoonkologii ve Fakultní nemocnici v Ostravě. Léčba každého onkologického pacienta v České republice se odhaduje na přibližně 8&nbsp;000&nbsp;Kč měsíčně. Věříme tedy, že tímto krokem společně dokážeme pomoci několika rodinám.",
		sk: "Natios z každého predaného produktu daruje 1 Kč detskej hematoonkológii vo Fakultnej nemocnici v Ostrave. Liečba každého onkologického pacienta v České republice sa odhaduje na približne 8&nbsp;000&nbsp;Kč mesačne. Veríme teda, že týmto krokom spoločne dokážeme pomôcť niekoľkým rodinám.",
		pl: "Natios z każdego sprzedanego produktu przekazuje 1 CZK na rzecz pediatrycznej hematoonkologii w Szpitalu Uniwersyteckim w Ostrawie. Leczenie jednego pacjenta onkologicznego w Czechach szacuje się na około 8&nbsp;000&nbsp;CZK miesięcznie. Wierzymy, że tym krokiem wspólnie możemy pomóc wielu rodzinom.",
	},
	natiosSupportTotalAmount: {
		cs: "Společně jsme již dokázali přispět přes 650&nbsp;000&nbsp;Kč. Děkujeme!",
		sk: "Spoločne sme už dokázali prispieť cez 650&nbsp;000&nbsp;Kč. Ďakujeme!",
		pl: "Wspólnie udało nam się już przekazać ponad 650&nbsp;000&nbsp;CZK. Dziękujemy!",
	},
	natiosSupportBlogUrl: {
		cs: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		sk: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		pl: "/",
	},
	moreAboutSupport: {
		cs: "Více o pomoci",
		sk: "Viac o pomoci",
		pl: "Więcej o pomocy",
	},
	insertFirstReview: {
		cs: "Vložit první hodnocení",
		sk: "Vložiť prvé hodnotenie",
		pl: "Wstaw pierwszą opinię",
	},
	watchDog: {
		cs: "Hlídat dostupnost",
		sk: "Strážiť dostupnosť",
		pl: "Obserwuj dostępność",
	},
	readMore: {
		cs: "Číst dále",
		sk: "Čítať ďalej",
		pl: "Czytaj dalej",
	},
	productVariants: {
		cs: "Varianty produktu",
		sk: "Varianty produktu",
		pl: "Warianty produktu",
	},
	showMoreVariants: {
		cs: "Zobrazit více variant",
		sk: "Zobraziť viac variantov",
		pl: "Pokaż więcej wariantów",
	},
	withVAT: {
		cs: "s DPH",
		sk: "s DPH",
		pl: "z VAT",
	},
	toCart: {
		cs: "Do košíku",
		sk: "Do košíka",
		pl: "Do koszyka",
	},
	alertMe: {
		cs: "Upozornit",
		sk: "Upozorniť",
		pl: "Powiadom",
	},
	buyMoreForFreeDelivery_1: {
		cs: "Nakupte ještě za",
		sk: "Nakúpte ešte za",
		pl: "Brakuje Ci jeszcze",
	},
	buyMoreForFreeDelivery_2: {
		cs: "a máte dopravu ZDARMA",
		sk: "a máte dopravu ZADARMO",
		pl: "do DARMOWEJ dostawy",
	},
	reachedFreeDelivery_1: {
		cs: "Máte dopravu",
		sk: "Máte dopravu",
		pl: "Zyskujesz dostawę",
	},
	reachedFreeDelivery_2: {
		cs: "ZDARMA!",
		sk: "ZADARMO!",
		pl: "GRATIS!",
	},
	gitFiltersUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_pl.json",
	},
	followOnInstagram: {
		cs: "Sledujte nás na Instagramu",
		sk: "Sledujte nás na Instagrame",
		pl: "Śledź nas na Instagramie",
	},
	/* gitHeurekaReviewsUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/data/ceneo_reviews_pl.json" 
	}, */
};


  // From: js/0_global/variables.js
/*--------------------------------------- Přepsání funkcí*/
function moveFilters() {}

let body = document.querySelector("body");

let shoptetDataLayer = dataLayer[0].shoptet;

let footer = document.querySelector("#footer");


  // ========================================
  // UTILITY FUNCTIONS
  // ========================================
  // From: js/1_utils/custom_resize.js
// Debounce function to limit the rate at which a function can fire
let resizeTimer;
let lastWindowWidth = window.innerWidth;

window.addEventListener("resize", function () {
	if (window.innerWidth !== lastWindowWidth) {
		document.dispatchEvent(new CustomEvent("resizeX"));

		clearTimeout(resizeTimer);
		resizeTimer = setTimeout(function () {
			lastWindowWidth = window.innerWidth;
			// Dispatch a custom event when X axis resize is complete
			console.log("CUSTOM EVENT DISPATCHED: debouncedResize");
			document.dispatchEvent(new CustomEvent("debouncedResize"));
		}, 250);
	}
});


  // From: js/1_utils/scroll_to_element.js
function scrollToElement(element) {
	const headerHeight = document.querySelector("#header").offsetHeight;
	window.scrollTo({
		top: element.getBoundingClientRect().top + window.pageYOffset - headerHeight,
		behavior: "smooth",
	});
}


  // From: js/1_utils/slider_custom.js
function inicializeSliderElement(sliderWrapper, sliderParent, sliderItem, customClass, itemForHeightForControls) {
	if (!sliderParent || !sliderItem || sliderItem.length === 0) {
		console.warn("inicializeSliderElement has been tried to be initialized with invalid parameters.");
		return;
	}

	if (!sliderWrapper) {
		const sliderWrapperElement = document.createElement("div");
		sliderWrapperElement.classList.add("slider-custom-wrapper");
		sliderParent.parentNode.insertBefore(sliderWrapperElement, sliderParent);
		sliderWrapperElement.appendChild(sliderParent);
		sliderWrapper = sliderWrapperElement;
	}
	sliderWrapper.classList.add(customClass, "slider-custom-wrapper");

	createControls();
	enableDragging();

	function createControls() {
		let initialControls = sliderWrapper.querySelectorAll(".carousel-control");
		if (initialControls && initialControls.length > 0) {
			initialControls.forEach((control) => control.remove());
		}

		const leftControl = document.createElement("div");
		leftControl.classList.add("carousel-control", "left", "hidden-control");
		leftControl.setAttribute("role", "button");
		leftControl.setAttribute("data-slide", "prev");

		const rightControl = document.createElement("div");
		rightControl.classList.add("carousel-control", "right");
		rightControl.setAttribute("role", "button");
		rightControl.setAttribute("data-slide", "next");

		sliderWrapper.appendChild(leftControl);
		sliderWrapper.appendChild(rightControl);

		leftControl.addEventListener("click", () => slide("left"));
		rightControl.addEventListener("click", () => slide("right"));

		setTopPositionOfControls();
		document.addEventListener("DOMContentLoaded", setTopPositionOfControls);
		window.addEventListener("resize", setTopPositionOfControls);

		function setTopPositionOfControls() {
			let heightItem;
			if (itemForHeightForControls) {
				heightItem = sliderItem[0].querySelector(itemForHeightForControls);
			} else {
				heightItem = sliderItem[0];
			}
			if (heightItem) {
				const style = window.getComputedStyle(heightItem);
				const marginTop = parseFloat(style.marginTop) || 0;
				const marginBottom = parseFloat(style.marginBottom) || 0;
				const heightOfItem = heightItem.offsetHeight || 0;
				const totalHeight = heightOfItem + marginTop + marginBottom;
				leftControl.style.top = totalHeight / 2 + "px";
				rightControl.style.top = totalHeight / 2 + "px";
				if (totalHeight === 0) {
					leftControl.style.top = "50%";
					rightControl.style.top = "50%";
				}
			} else {
				leftControl.style.top = "50%";
				rightControl.style.top = "50%";
			}
		}

		//if sliderParent is not scrollable hide controls
		if (sliderParent.scrollWidth <= sliderParent.clientWidth) {
			leftControl.classList.add("hidden-control");
			rightControl.classList.add("hidden-control");
		}
	}

	function slide(direction) {
		if (sliderParent.classList.contains("sliding")) return;
		sliderParent.classList.add("sliding");

		const numberOfItems = parseInt(getComputedStyle(sliderWrapper).getPropertyValue("--number-of-items")) || 1;
		const gapValue = parseInt(getComputedStyle(sliderParent).getPropertyValue("--gap")) || 0;
		const largeItemMultiplier =
			parseFloat(getComputedStyle(sliderWrapper).getPropertyValue("--width-multiplier-of-1st-item")) - 1 || 0;
		const nextItemPreview = parseInt(getComputedStyle(sliderWrapper).getPropertyValue("--next-item-preview")) || 0;

		let scrollAmount;
		/* 	if (sliderItem.length > 2) {
			scrollAmount =
				sliderItem[2]?.offsetWidth * numberOfItems +
					gapValue * (numberOfItems - largeItemMultiplier - 1) +
					nextItemPreview || 200;
			
		} else {
			scrollAmount =
				sliderItem[0]?.offsetWidth * numberOfItems +
					gapValue * (numberOfItems - largeItemMultiplier - 1) +
					nextItemPreview || 200;
		} */

		scrollAmount = sliderParent.offsetWidth - (nextItemPreview - gapValue);

		const to = direction === "left" ? sliderParent.scrollLeft - scrollAmount : sliderParent.scrollLeft + scrollAmount;

		sliderParent.scrollTo({ left: to, behavior: "smooth" });

		setTimeout(() => {
			sliderParent.classList.remove("sliding");
		}, 300);
	}

	function enableDragging() {
		let isDragging = false;
		let startX = 0;
		let startScrollLeft = 0;
		let moved = false;
		let activePointerId = null;
		let moveThreshold = 5; // px

		// Start drag
		const onPointerDown = (e) => {
			// Only primary button if mouse
			if (e.pointerType === "mouse" && e.button !== 0) return;

			isDragging = true;
			moved = false;
			activePointerId = e.pointerId;

			startX = e.clientX;
			startScrollLeft = sliderParent.scrollLeft;

			sliderParent.classList.add("grabbing");

			// Attach move/up/cancel to window for robust dragging
			window.addEventListener("pointermove", onPointerMove);
			window.addEventListener("pointerup", endDrag);
			window.addEventListener("pointercancel", endDrag);
			window.addEventListener("pointerleave", endDrag);
		};

		// Drag move
		const onPointerMove = (e) => {
			if (!isDragging || e.pointerId !== activePointerId) return;

			const dx = e.clientX - startX;
			if (Math.abs(dx) > moveThreshold) moved = true;
			sliderParent.scrollLeft = startScrollLeft - dx;

			e.preventDefault();
		};

		// End/cancel drag
		const endDrag = (e) => {
			if (e && activePointerId !== null && e.pointerId !== activePointerId) return;
			isDragging = false;
			activePointerId = null;
			sliderParent.classList.remove("grabbing");

			window.removeEventListener("pointermove", onPointerMove);
			window.removeEventListener("pointerup", endDrag);
			window.removeEventListener("pointercancel", endDrag);
			window.removeEventListener("pointerleave", endDrag);
		};

		// Suppress clicks if a drag happened (avoids accidental link/card clicks)
		const onClick = (e) => {
			if (moved) {
				e.preventDefault();
				e.stopPropagation();
				moved = false; // reset
			}
		};

		// Attach pointerdown to sliderWrapper so dragging works from wrapper or any child
		sliderWrapper.addEventListener("pointerdown", onPointerDown);
		sliderParent.addEventListener("click", onClick);

		function removeHiddenControl(element) {
			element.classList.remove("hidden-control");
		}
		function addHiddenControl(element) {
			element.classList.add("hidden-control");
		}

		let leftControl = sliderWrapper.querySelector(".carousel-control.left");
		let rightControl = sliderWrapper.querySelector(".carousel-control.right");
		if (leftControl && rightControl) {
			sliderParent.addEventListener("scroll", () => {
				if (sliderParent.scrollLeft <= 0) {
					addHiddenControl(leftControl);
				} else {
					removeHiddenControl(leftControl);
				}

				if (sliderParent.scrollLeft >= sliderParent.scrollWidth - sliderParent.clientWidth - 1) {
					addHiddenControl(rightControl);
				} else {
					removeHiddenControl(rightControl);
				}
			});
		}
	}
}

let allProductsBlocks = document.querySelectorAll(".products-block:not(.products-page)");
if (allProductsBlocks && allProductsBlocks.length > 0) {
	allProductsBlocks.forEach((block) => {
		let productsBlockItems = block.querySelectorAll(".product");
		inicializeSliderElement(null, block, productsBlockItems, "products-slider", "img");
	});
}


  // ========================================
  // COMPONENTS
  // ========================================
  // From: js/2_components/carousel.js
//body body contains in-index
if (body.classList.contains("in-index")) {
	carouselThumbnails();
}

function carouselThumbnails() {
	let carousel = document.querySelector("#carousel");
	if (!carousel) return;

	let items = carousel.querySelectorAll(".item");

	if (!items || items.length === 0) return;

	const thumbNailsWrapper = document.createElement("div");
	thumbNailsWrapper.classList.add("carousel-thumbnails-wrapper");

	items.forEach((item, index) => {
		let thumbNail = item.querySelector(".item-thumbnail");
		if (thumbNail) {
			thumbNailsWrapper.appendChild(thumbNail);
			if (index === 0) {
				thumbNail.classList.add("active");
			}

			thumbNail.addEventListener("click", () => {
				if (thumbNail.classList.contains("active")) return;
				//remove active class from all thumbnails
				let allThumbnails = thumbNailsWrapper.querySelectorAll(".item-thumbnail");
				allThumbnails.forEach((thumb) => {
					thumb.classList.remove("active");
				});
				//add active class to clicked thumbnail
				thumbNail.classList.add("active");

				let allItems = carousel.querySelectorAll(".item");
				allItems.forEach((it) => {
					it.classList.remove("previous");

					if (it.classList.contains("active")) {
						it.classList.remove("active");
						it.classList.add("previous");
					}
				});
				item.classList.add("active");
			});
		}
	});
	carousel.appendChild(thumbNailsWrapper);
}


  // From: js/2_components/cbox.js
// Close colorbox when clicking outside content area
function setupColorboxClose() {
	const colorbox = document.querySelector("#colorbox");
	if (!colorbox || colorbox.hasAttribute("data-close-listener")) return;

	colorbox.setAttribute("data-close-listener", "true");

	colorbox.addEventListener("click", function (e) {
		const cboxContent = this.querySelector("#cboxContent");

		// Check if click is on colorbox, but not on cboxContent or its children
		if (e.target === this || !cboxContent.contains(e.target)) {
			const cboxClose = this.querySelector("#cboxClose");
			if (cboxClose) {
				cboxClose.click();
			}
		}
	});
}

// Try to setup immediately and periodically check
setupColorboxClose();
setInterval(setupColorboxClose, 500);


  // From: js/2_components/dklab_compare.js
/*Zmena default pozice kam se umistuje doplnek*/
dkLabPorovnavacZboziDataLayer.template.classic.selectors.headerIconAddBefore = "#header .header-top .site-name-wrapper";

/*zjisteni, kolik produktu je v porovnani*/
let lastEm = 0;
let compareLoadedFirstTime = true;
document.addEventListener("dkLabProductComparerHeaderChanged", function () {
	let compareInHeader = document.querySelector("#header #dkLabComparerHeaderWrappper");
	if (!compareInHeader) return;

	let compareSpan = compareInHeader.querySelector("span.dkLabComparerHeaderIconBtn");
	if (!compareSpan) return;

	const compareTextSpan = document.createElement("span");
	compareTextSpan.textContent = translationsStrings.compare[activeLang];
	compareSpan.prepend(compareTextSpan);

	let em = compareInHeader.querySelector("em");
	let emText = em ? em.textContent : "0";
	if (!em) {
		compareInHeader.classList.add("no-count");
	} else {
		compareInHeader.classList.remove("no-count");
	}

	compareSpan.addEventListener("click", function (e) {
		//dispatch event "CompareSpanClicked"
		const event = new Event("dkLabCompareHeaderIconClicked");
		document.dispatchEvent(event);
		console.log(
			"%c dkLabCompareHeaderIconClicked event dispatched ",
			"background: lime; color: black; padding: 5px 10px; font-weight: bold;"
		);
	});

	if (emText >= "2" && emText > lastEm && compareLoadedFirstTime === false) {
		compareSpan.click();
	}
	lastEm = emText;
	compareLoadedFirstTime = false;
});

document.addEventListener("dkLabCompareHeaderIconClicked", function () {
	// Wait for table to appear in colorbox
	const colorbox = document.querySelector("#colorbox");
	if (!colorbox) return;

	const observer = new MutationObserver((_, obs) => {
		let dkLabComparerTableDiv = document.querySelector("#dkLabComparerTableDiv");
		if (!dkLabComparerTableDiv) return;

		let dkLabComparerTable = dkLabComparerTableDiv.querySelector("table#dkLabComparerTable");
		if (!dkLabComparerTable) return;

		// Table found, disconnect observer and proceed
		obs.disconnect();

		// Transform table into grid layout
		transformTableToGrid(dkLabComparerTable, dkLabComparerTableDiv);
		setupCloseButtons();
	});

	observer.observe(colorbox, {
		childList: true,
		subtree: true,
	});

	function setupCloseButtons() {
		let closeBtnsInImage = document.querySelectorAll(".dkLabComparerImage >span");
		if (closeBtnsInImage && closeBtnsInImage.length > 0) {
			closeBtnsInImage.forEach((btn) => {
				btn.addEventListener("click", function () {
					const event = new Event("dkLabCompareCloseButtonClicked");
					document.dispatchEvent(event);
					console.log(
						"%c dkLabCompareCloseButtonClicked event dispatched ",
						"background: orange; color: black; padding: 5px 10px; font-weight: bold;"
					);

					// Wait for table to update after close button click
					const updateObserver = new MutationObserver((_, obs) => {
						let dkLabComparerTableDiv = document.querySelector("#dkLabComparerTableDiv");
						if (!dkLabComparerTableDiv) return;

						let dkLabComparerTable = dkLabComparerTableDiv.querySelector("table#dkLabComparerTable");
						if (!dkLabComparerTable) return;

						obs.disconnect();
						transformTableToGrid(dkLabComparerTable, dkLabComparerTableDiv);
						setupCloseButtons();
					});

					updateObserver.observe(colorbox, {
						childList: true,
						subtree: true,
					});
				});
			});
		}
	}
});

function transformTableToGrid(table, container) {
	const rows = Array.from(table.querySelectorAll("tr"));
	if (rows.length === 0) return;

	// Remove existing grid if it exists
	const existingGrid = container.querySelector(".dklab-comparer-grid");
	if (existingGrid) {
		return;
	}

	// Remove existing scroll controls if they exist
	const existingControls = container.querySelectorAll(".dklab-comparer-control");
	existingControls.forEach((control) => control.remove());

	// Get number of columns from the first row
	const columnCount = rows[0].querySelectorAll("td").length;

	// Find the image row (row with .dkLabComparerImage) and button row
	let imageRowIndex = -1;
	let buttonRowIndex = -1;

	rows.forEach((row, index) => {
		if (row.querySelector(".dkLabComparerImage")) {
			imageRowIndex = index;
		}
		if (row.querySelector("button.btn-cart")) {
			buttonRowIndex = index;
		}
	});

	// Create grid container
	const gridContainer = document.createElement("div");
	gridContainer.className = "dklab-comparer-grid";

	// Build grid template: first column 150px, rest are 260px with auto
	const gridColumns = ["180px"];
	for (let i = 1; i < columnCount; i++) {
		gridColumns.push("270px");
	}
	gridContainer.style.gridTemplateColumns = gridColumns.join(" ");

	// Reorder rows: image first, button last, others in between
	const orderedRows = [];

	if (imageRowIndex !== -1) {
		orderedRows.push(rows[imageRowIndex]);
	}

	rows.forEach((row, index) => {
		if (index !== imageRowIndex && index !== buttonRowIndex) {
			orderedRows.push(row);
		}
	});

	if (buttonRowIndex !== -1) {
		orderedRows.push(rows[buttonRowIndex]);
	}

	// Find price row index in orderedRows
	let priceRowIndex = -1;
	orderedRows.forEach((row, index) => {
		const cells = Array.from(row.querySelectorAll("td"));
		if (cells.some((cell) => cell.textContent.trim().match(/\d+\s*(Kč|zł|€|Eur)/))) {
			priceRowIndex = index;
		}
	});

	orderedRows.forEach((row, rowIndex) => {
		const cells = row.querySelectorAll("td");
		const hasImageCell = row.querySelector(".dkLabComparerImage");
		const hasProductName = row.querySelector(".dkLabComparerProductName");
		const hasPrice = Array.from(cells).some((cell) => cell.textContent.trim().match(/\d+\s*(Kč|zł|€|Eur)/));
		const hasButton = row.querySelector("button.btn-cart");

		const isFirstParameterRow = priceRowIndex !== -1 && rowIndex === priceRowIndex + 1;

		cells.forEach((cell, cellIndex) => {
			const gridItem = document.createElement("div");
			gridItem.className = "dklab-comparer-grid-item";
			gridItem.innerHTML = cell.innerHTML;

			// Preserve classes from original cell
			if (cell.className) {
				gridItem.classList.add(...cell.className.split(" "));
			}

			// Add no-bg class to first column
			if (cellIndex === 0) {
				gridItem.classList.add("no-bg");
			}

			// Add first-parameter class to first row after price row
			if (isFirstParameterRow) {
				gridItem.classList.add("first-parameter");
			}

			// Add dkLabComparerImage class to first column if row has image cells
			if (hasImageCell && cellIndex === 0) {
				gridItem.classList.add("dkLabComparerImage");
			}

			// Add class for product names
			if (cell.querySelector(".dkLabComparerProductName")) {
				gridItem.classList.add("dklab-comparer-product-name");
			}

			// Add dklab-comparer-product-name to first column if row has product names
			if (hasProductName && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-product-name");
			}

			// Add class for prices (detect currency symbols)
			const cellText = cell.textContent.trim();
			if (cellText.match(/\d+\s*(Kč|zł|€|Eur)/)) {
				gridItem.classList.add("dklab-comparer-price");
			}

			// Add dklab-comparer-price to first column if row has prices
			if (hasPrice && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-price");
			}

			// Add class for buttons
			if (cell.querySelector("button.btn-cart")) {
				gridItem.classList.add("dklab-comparer-button");
			}

			// Add dklab-comparer-button to first column if row has buttons
			if (hasButton && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-button");
			}

			gridContainer.appendChild(gridItem);
		});
	});

	// Replace table with grid
	table.style.display = "none";
	container.appendChild(gridContainer);

	// Add scroll controls if there's horizontal overflow
	addScrollControls(container);
}

function addScrollControls(container) {
	// Check if container has horizontal overflow
	const hasOverflow = container.scrollWidth > container.clientWidth;

	if (!hasOverflow) return;

	// Create left control
	const controlLeft = document.createElement("div");
	controlLeft.classList.add("dklab-comparer-control", "left");

	// Create right control
	const controlRight = document.createElement("div");
	controlRight.classList.add("dklab-comparer-control", "right");

	// Update controls visibility based on scroll position
	function updateControls() {
		const scrollLeft = container.scrollLeft;
		const maxScroll = container.scrollWidth - container.clientWidth;

		if (scrollLeft > 0) {
			controlLeft.style.opacity = "1";
			controlLeft.style.pointerEvents = "auto";
		} else {
			controlLeft.style.opacity = "0";
			controlLeft.style.pointerEvents = "none";
		}

		if (scrollLeft < maxScroll - 1) {
			controlRight.style.opacity = "1";
			controlRight.style.pointerEvents = "auto";
		} else {
			controlRight.style.opacity = "0";
			controlRight.style.pointerEvents = "none";
		}
	}

	// Scroll left
	controlLeft.addEventListener("click", function () {
		container.scrollBy({ left: -270, behavior: "smooth" });
	});

	// Scroll right
	controlRight.addEventListener("click", function () {
		container.scrollBy({ left: 270, behavior: "smooth" });
	});

	// Listen to scroll events
	container.addEventListener("scroll", updateControls);

	// Append controls
	container.appendChild(controlLeft);
	container.appendChild(controlRight);

	// Initial update
	updateControls();
}


  // From: js/2_components/dklab_favorites.js
/* document.addEventListener(
	"dkLabFavouriteProductsHeaderChanged",
	function () {
		let favoritesInHeader = document.querySelector("#header .navigation-buttons #dkLabFavHeaderWrapper");
		if (!favoritesInHeader) return;

		let headerTop = document.querySelector("#header .header-top");
		if (!headerTop) return;

		headerTop.appendChild(favoritesInHeader);
	},
	{ once: true }
); */

/*Zmena default pozice kam se umistuje doplnek*/
dkLabOblibeneDataLayer.template.classic.selectors.headerIconAddBefore = "#header .header-top .site-name-wrapper";

document.addEventListener("dkLabFavouriteProductsHeaderChanged", function () {
	let favoritesInHeader = document.querySelector("#header #dkLabFavHeaderWrapper");
	if (!favoritesInHeader) return;

	let favoritesHref = favoritesInHeader.querySelector("a");
	if (!favoritesHref) return;

	const favoritesSpan = document.createElement("span");
	favoritesSpan.textContent = translationsStrings.favorites[activeLang];
	favoritesHref.prepend(favoritesSpan);

	let em = favoritesInHeader.querySelector("em");
	if (!em) {
		favoritesInHeader.classList.add("no-count");
	} else {
		favoritesInHeader.classList.remove("no-count");
	}
});


  // From: js/2_components/footer_bottom.js
function footerBottomEdit() {
	if (!footer) return;

	let footerSocials = footer.querySelector(".footer-socials");
	if (!footerSocials) return;

	let footerBottom = footer.querySelector(".footer-bottom");
	if (!footerBottom) return;

	footerBottom.prepend(footerSocials);

	let signature = footer.querySelector("#signature");
	if (!signature) return;

	const spanAnd = document.createElement("span");
	spanAnd.textContent = " & ";
	signature.appendChild(spanAnd);

	const filipHosek = document.createElement("a");
	filipHosek.href = "https://partneri.shoptet.cz/profesionalove/filip-hosek/";
	filipHosek.target = "_blank";
	filipHosek.rel = "noopener";
	filipHosek.className = "footer-signature-filip-hosek";
	filipHosek.textContent = "Filip Hošek";
	signature.appendChild(filipHosek);
}
footerBottomEdit();


  // From: js/2_components/footer_instagram.js
function editFooterInstagram() {
	if (!footer) return;

	let iGFooterButton = footer.querySelector(".instagram-follow-btn a");
	if (!iGFooterButton) return;

	let iGFooterButtonLink = iGFooterButton.getAttribute("href");
	if (!iGFooterButtonLink) return;

	let iGHeading = footer.querySelector("h4");
	if (!iGHeading) return;

	let accountName = iGFooterButtonLink.split("https://www.instagram.com/")[1];
	if (accountName.endsWith("/")) {
		accountName = accountName.slice(0, -1);
	}

	const link = document.createElement("a");
	link.href = iGFooterButtonLink;
	link.target = "_blank";
	link.rel = "noopener";

	const followText = document.createElement("span");
	followText.className = "ig-follow-text";
	followText.textContent = translationsStrings.followOnInstagram[activeLang];

	const accountNameSpan = document.createElement("span");
	accountNameSpan.className = "ig-account-name";
	accountNameSpan.textContent = accountName;

	link.appendChild(followText);
	link.appendChild(document.createTextNode(" "));
	link.appendChild(accountNameSpan);

	iGHeading.innerHTML = "";
	iGHeading.appendChild(link);
}

editFooterInstagram();


  // From: js/2_components/go_top_btn.js
function goTopBtn() {
	const goTopBtn = document.querySelector(".goToTop__button");
	if (!goTopBtn) return;

	goTopBtn.addEventListener("click", (e) => {
		e.preventDefault();
		window.scrollTo({
			top: 0,
			behavior: "smooth",
		});
	});
}

goTopBtn();


  // From: js/2_components/header.js
let topNavigationBar = document.querySelector(".top-navigation-bar");
if (topNavigationBar) {
	let headerTop = document.querySelector(".header-top");
	if (headerTop) {
		let projectPhone = topNavigationBar.querySelector(".project-phone");
		if (projectPhone) {
			headerTop.appendChild(projectPhone);

			const contactHours = document.createElement("span");
			contactHours.classList.add("opening-hours");
			contactHours.textContent = translationsStrings.contactHours[activeLang];
			projectPhone.appendChild(contactHours);
		}

		let loginBtn = topNavigationBar.querySelector(".top-nav-button-login");
		if (loginBtn) {
			headerTop.appendChild(loginBtn);
		}
	}
}


  // From: js/2_components/header_left_to_free_shipping.js
function createFreeShippingInfo() {
	if (!shoptetDataLayer?.cartInfo) return;

	const { freeShipping, leftToFreeShipping } = shoptetDataLayer.cartInfo;
	if (freeShipping == null) return;

	const navigationButtons = document.querySelector("#header .navigation-buttons");
	if (!navigationButtons) return;

	const freeShippingElement = document.createElement("div");
	freeShippingElement.classList.add("header-free-shipping-info");

	const leftToFreeShippingPrice = leftToFreeShipping?.priceLeft;
	if (!leftToFreeShippingPrice) return;

	const leftToFreeShippingPriceFormatted = leftToFreeShipping?.formattedPrice;
	if (!leftToFreeShippingPriceFormatted) return;

	if (freeShipping || leftToFreeShippingPrice <= 0) {
		// Free shipping reached
		const textOne = document.createElement("span");
		textOne.classList.add("free-shipping-text-one");
		textOne.innerText = translationsStrings.reachedFreeDelivery_1[activeLang] + " ";

		const textTwo = document.createElement("span");
		textTwo.classList.add("free-shipping-text-two");
		textTwo.innerText = translationsStrings.reachedFreeDelivery_2[activeLang];

		freeShippingElement.appendChild(textOne);
		freeShippingElement.appendChild(textTwo);
	} else {
		// Show amount left for free shipping

		const textOne = document.createElement("span");
		textOne.classList.add("free-shipping-text-one");
		textOne.innerText = translationsStrings.buyMoreForFreeDelivery_1[activeLang] + " ";

		const amount = document.createElement("b");
		amount.classList.add("free-shipping-amount");
		amount.innerText = leftToFreeShippingPriceFormatted;

		const textTwo = document.createElement("span");
		textTwo.classList.add("free-shipping-text-two");
		textTwo.innerText = translationsStrings.buyMoreForFreeDelivery_2[activeLang];

		textOne.appendChild(amount);
		freeShippingElement.appendChild(textOne);
		freeShippingElement.appendChild(textTwo);
	}

	navigationButtons.prepend(freeShippingElement);
}

createFreeShippingInfo();


  // From: js/2_components/measure_units_download.js
/*NEW MEASURE UNIT - JSON GITHUB*/
async function downloadAndSaveMeasureUnitFilter() {
	const url = translationsStrings.gitFiltersUrl[activeLang];
	const storageKey = "measureFilters";
	const expiryKey = "measureFilters_expiry_01";

	// Check if data is already in localStorage and not expired
	const now = Date.now();
	const expiry = localStorage.getItem(expiryKey);
	const cached = localStorage.getItem(storageKey);
	if (expiry && cached && now < parseInt(expiry)) {
		// Data is still valid
		console.log("Measure filters loaded from localStorage.");
		measureFiltersData = JSON.parse(cached);
		return;
	}

	// Fetch and save
	try {
		const response = await fetch(url);
		if (!response.ok) throw new Error("Network response was not ok");
		const data = await response.json();
		localStorage.setItem(storageKey, JSON.stringify(data));
		localStorage.setItem(expiryKey, (now + 24 * 60 * 60 * 1000).toString());
		console.log("Measure filters saved to localStorage.");
		measureFiltersData = data;
	} catch (error) {
		console.warn("Failed to fetch Measure filters:", error);
	}
}


  // From: js/2_components/measure_units_products_block.js
async function measureUnitFromFiltersProducts() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	await downloadAndSaveMeasureUnitFilter();
	let productFilterData = measureFiltersData;
	if (!productFilterData || productFilterData.length === 0) {
		return; // No filter data available
	}

	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("product-edited-measure")) {
			return; // Skip if already processed
		}
		product.classList.add("product-edited-measure");
		let productCodeForFilter = product.querySelector("span[data-micro='sku']")?.textContent.trim();
		if (!productCodeForFilter) {
			console.warn("Product code not found for a product.");
			return;
		}

		let amountText = productFilterData.find((item) => item.code === productCodeForFilter)?.value;
		if (!amountText) {
			console.warn("No measure unit found for product code:", productCodeForFilter);
			return;
		}

		// Convert comma to dot, then extract the number and unit
		let normalizedAmountText = amountText.replace(",", ".").trim();

		// Extract the numeric part (including decimal)
		let productMeasureAmount = normalizedAmountText.match(/[\d.]+/) ? normalizedAmountText.match(/[\d.]+/)[0] : "";

		// Extract the unit part (letters and spaces after the number)
		let productMeasureUnit = normalizedAmountText.replace(/[\d.\s]+/, "").trim();

		/* 	let productMeasureAmount = amountText.replace(/[^\d]/g, ""); //keep only digits from the measure unit
		let productMeasureUnit = amountText.replace(/[\d\s]/g, ""); //keep only letters from the measure unit
 */
		let ratingsWrapper = product.querySelector(".ratings-wrapper");
		if (ratingsWrapper) {
			// Create a new span element to display the amount
			let measureUnitSpan = document.createElement("span");
			measureUnitSpan.className = "product-measure-unit";
			measureUnitSpan.textContent = amountText;

			// Append the amount span to the ratings wrapper
			ratingsWrapper.appendChild(measureUnitSpan);
		}

		const pricePerUnitDiv = document.createElement("div");
		pricePerUnitDiv.className = "product-price-per-unit";
		let prices = product.querySelector(".prices");

		let priceFinal = product.querySelector(".price-final strong");
		let priceFinalValue;

		if (priceFinal) {
			// Extract the text content, trim it, and remove everything but numbers
			priceFinalValue = priceFinal.textContent.trim().replace(/[^\d.,]/g, ""); // Keep only digits, commas, and dots
			priceFinalValue = parseFloat(priceFinalValue.replace(",", ".")).toFixed(2);
		}

		let singleMeasuringUnit = {};
		if (csLang) {
			singleMeasuringUnit = {
				kapslí: "kapsle",
				tablet: "tableta",
				tobolek: "tobolka",
				tabletek: "tabletka",
				dávek: "dávka",
				dávky: "dávka",
				produkty: "produkt",
				produktů: "produkt",
			};
		}
		if (skLang) {
			singleMeasuringUnit = {
				kapsúl: "kapsula",
				kapsula: "kapsula",
				tabliet: "tableta",
				tablietek: "tabletka",
				dávok: "dávka",
				dávky: "dávka",
				produktov: "produkt",
				produkty: "produkt",
			};
		}
		if (plLang) {
			singleMeasuringUnit = {
				kapsułek: "kapsułka",
				kapsułki: "kapsułka",
				tabletek: "tableta",
				saszetek: "saszetka",
				pastylek: "pastylka",
				gumisiów: "gumiś",
				dawek: "dawka",
				produktów: "produkt",
				produkty: "produkt",
			};
		}

		let pricePerUnit_Unit;

		let foundUnitMatch = false;

		// Iterate over the keys in the object
		for (let key in singleMeasuringUnit) {
			if (productMeasureUnit.includes(key)) {
				foundUnitMatch = true;
				pricePerUnit_Unit = singleMeasuringUnit[key];
				break; // Exit the loop once a match is found
			}
		}
		if (!foundUnitMatch) {
			// If no match is found, use the original measure unit
			pricePerUnit_Unit = productMeasureUnit;
		}

		const pricePerUnit_Value = priceFinalValue / productMeasureAmount;

		const pricePerUnit_ValueSpan = document.createElement("span");
		pricePerUnit_ValueSpan.className = "product-price-per-unit-value";

		if (csLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " Kč / 1 " + pricePerUnit_Unit;
		}
		if (skLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " € / 1 " + pricePerUnit_Unit;
		}
		if (plLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " zł / 1 " + pricePerUnit_Unit;
		}

		if (prices && pricePerUnitDiv) {
			prices.appendChild(pricePerUnitDiv);
			pricePerUnitDiv.appendChild(pricePerUnit_ValueSpan);
		}
	});
}

let measureFiltersData = [];
measureUnitFromFiltersProducts();
document.addEventListener("ShoptetDOMContentLoaded", function (event) {
	measureUnitFromFiltersProducts();
});
document.addEventListener("luigiSearchDone", function (event) {
	measureUnitFromFiltersProducts();
});


  // From: js/2_components/menu.js
/*-------------------------------------- MENU OVERFLOW DETECTION*/
let menuLevelOne = document.querySelector(".menu-level-1");

function createMenuHelper() {
	if (document.querySelector(".menu-helper-custom")) {
		return;
	}
	const menuHelperCustom = document.createElement("div");
	menuHelperCustom.className = "menu-helper-custom";

	const menuHelperCustomText = document.createElement("span");
	menuHelperCustom.appendChild(menuHelperCustomText);
	menuHelperCustomText.textContent = translationsStrings.more[activeLang];

	const menuHelperCustomSubmenu = document.createElement("ul");
	menuHelperCustomSubmenu.className = "menu-helper-custom-submenu";
	menuHelperCustom.appendChild(menuHelperCustomSubmenu);

	if (menuLevelOne) {
		menuLevelOne.appendChild(menuHelperCustom);
	}
}

function inicializeMenu() {
	createMenuHelper();
	let menuHelperCustom = document.querySelector(".menu-helper-custom");
	let menuHelperCustomSubmenu = menuHelperCustom.querySelector(".menu-helper-custom-submenu");
	if (!menuLevelOne || !menuHelperCustom || !menuHelperCustomSubmenu) {
		return;
	}

	if (isMobile) {
		let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
		for (let i = 0; i < menuLevelOneLis.length; i++) {
			menuHelperCustomSubmenu.prepend(menuLevelOneLis[menuLevelOneLis.length - 1 - i]);
		}
		menuHelperCustom.classList.add("active");
		return;
	}

	/*Initial state*/
	menuHelperCustom.classList.remove("active");
	menuHelperCustomSubmenu.querySelectorAll(":scope>li").forEach((li) => {
		menuLevelOne.appendChild(li);
	});
	menuLevelOne.appendChild(menuHelperCustom);
	let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
	let overflownItems = false;
	let overflownIndex = -1;
	const menuLevelOneWidth = menuLevelOne.offsetWidth;
	const menuHelperCustomWidth = menuHelperCustom.offsetWidth;
	let cumulativeWidth = 0;

	//Detect overflown items
	for (let i = 0; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		cumulativeWidth += li.offsetWidth;
		if (cumulativeWidth > menuLevelOneWidth) {
			overflownItems = true;
			overflownIndex = i;
			break;
		}
	}

	if (!overflownItems) {
		return;
	}

	//calculate if helper fits
	cumulativeWidth = menuHelperCustomWidth + cumulativeWidth;
	if (cumulativeWidth > menuLevelOneWidth) {
		overflownIndex = overflownIndex - 1;
	}

	//move overflown items to helper
	for (let i = overflownIndex; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		menuHelperCustomSubmenu.appendChild(li);
	}
	menuHelperCustom.classList.add("active");
}

/*Edit menu-level-2 href and img*/
function editMenuLevel2() {
	let menusLevel2 = document.querySelectorAll("#header .menu-level-2");
	if (!menusLevel2 || menusLevel2.length === 0) {
		return;
	}

	menusLevel2.forEach((menu) => {
		let childrenLi = menu.querySelectorAll(":scope>li");
		if (!childrenLi || childrenLi.length === 0) {
			return;
		}
		childrenLi.forEach((li) => {
			let img = li.querySelector(":scope>a>img");
			if (img) {
				li.prepend(img);
			}
		});
	});
}

/*Move cart next to menu*/
function moveCartNextToMenu() {
	let cart = document.querySelector("#header .navigation-buttons");
	let navigation = document.querySelector("#header #navigation");
	if (cart && navigation) {
		navigation.appendChild(cart);
	}
}

document.addEventListener("DOMContentLoaded", function () {
	moveCartNextToMenu();
	inicializeMenu();
	editMenuLevel2();
});

document.addEventListener("debouncedResize", function () {
	inicializeMenu();
});


  // From: js/2_components/products_block_amount_to_cart.js
function addAmountToCartInProductsBlock() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("amount-to-cart-added")) {
			return; // Skip if already processed
		}
		product.classList.add("amount-to-cart-added");
		let productCodeForFilter = product.querySelector("span[data-micro='sku']")?.textContent.trim();
		if (!productCodeForFilter) {
			console.warn("Product code not found for a product.");
			return;
		}

		let pToolForm = product.querySelector(".p-tools form");
		if (!pToolForm) {
			console.warn("Add to cart form not found for product code:", productCodeForFilter);
			return;
		}
		const amountInput = document.createElement("span");
		amountInput.classList.add("quantity");
		amountInput.innerHTML = `
	
    <span class="increase-tooltip js-increase-tooltip" data-trigger="manual" data-container="body" data-original-title="Není možné zakoupit více než 999 ks." aria-hidden="true" role="tooltip" data-testid="tooltip">
    </span>

    <span class="decrease-tooltip js-decrease-tooltip" data-trigger="manual" data-container="body" data-original-title="Minimální množství, které lze zakoupit, je 1 ks." aria-hidden="true" role="tooltip" data-testid="tooltip">
    </span>
    <label>
        <input type="number" name="amount" value="1" class="amount" autocomplete="off" data-decimals="0" step="1" min="1" max="999" aria-label="Množství" data-testid="cartAmount" data-np-intersection-state="visible">
    </label>

    <button class="increase" type="button" aria-label="Zvýšit množství o 1" data-testid="increase">
            <span class="increase__sign">+</span>
    </button>

    <button class="decrease" type="button" aria-label="Snížit množství o 1" data-testid="decrease">
            <span class="decrease__sign">−</span>
    </button>

		`;
		pToolForm.appendChild(amountInput);
	});
}

addAmountToCartInProductsBlock();


  // From: js/2_components/products_block_reviews_number.js
/*---------ACTION PRICE AND REVIEWS NUMBER*/
function productsBlockReviewsNumber() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("reviews-added")) {
			return; // Skip if already processed
		}
		product.classList.add("reviews-added");

		let starWrapper = product.querySelector(".stars-wrapper");
		if (starWrapper) {
			let reviewsNumber = starWrapper.getAttribute("data-micro-rating-count");
			if (reviewsNumber) {
				const reviewsNumberSpan = document.createElement("span");
				reviewsNumberSpan.className = "reviews-number";
				reviewsNumberSpan.innerHTML = reviewsNumber + "x";
				starWrapper.appendChild(reviewsNumberSpan);
			}
		}
	});
}

productsBlockReviewsNumber();


  // From: js/2_components/products_block_standard_price.js
/*---------ACTION PRICE AND REVIEWS NUMBER*/
function productsBlockStandardPrice() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("standard-price-moved")) {
			return; // Skip if already processed
		}
		product.classList.add("standard-price-moved");

		let standardPrice = product.querySelector(".flag-discount .price-standard");
		let finalPrice = product.querySelector(".price-final");
		if (standardPrice && finalPrice) {
			finalPrice.appendChild(standardPrice);
		}
	});
}

productsBlockStandardPrice();


  // From: js/2_components/products_block_swap_images.js
const producsBlockImageWidth = "423";
const producsBlockImageHeight = "423";

function customSwapImages() {
	let swapImagesProducts = document.querySelectorAll(".products-block .swap-images");
	if (!swapImagesProducts || swapImagesProducts.length === 0) {
		return; // No products found
	}
	swapImagesProducts.forEach((product) => {
		if (product.classList.contains("custom-swap-images-added")) {
			return; // Skip if already processed
		}
		product.classList.add("custom-swap-images-added");

		let swapImage = product.querySelector(".swap-image");
		if (!swapImage) {
			console.warn("Swap image not found for a product.");
			return;
		}

		let swapImageA = product.querySelector("a.image");
		if (!swapImageA) {
			console.warn("Image link not found for a product.");
			return;
		}

		const customFirstImage = document.createElement("img");
		customFirstImage.classList.add("custom-first-image");
		customFirstImage.src = swapImage.getAttribute("data-src") || "";
		customFirstImage.setAttribute("data-src", swapImage.getAttribute("data-src") || "");
		customFirstImage.alt = swapImage.alt || "";
		customFirstImage.width = producsBlockImageWidth;
		customFirstImage.height = producsBlockImageHeight;
		customFirstImage.loading = "lazy";
		customFirstImage.fetchPriority = "low";

		const customSecondImage = document.createElement("img");
		customSecondImage.classList.add("custom-second-image");
		customSecondImage.src = swapImage.getAttribute("data-next") || swapImage.src || "";
		customSecondImage.alt = swapImage.alt || "";
		customSecondImage.width = producsBlockImageWidth;
		customSecondImage.height = producsBlockImageHeight;
		customSecondImage.loading = "lazy";
		customSecondImage.fetchPriority = "low";

		swapImage.remove();
		swapImageA.appendChild(customFirstImage);
		swapImageA.appendChild(customSecondImage);
	});
}
customSwapImages();

/* // Remove old swap-images event handlers
$(document).off("mouseenter mouseleave", ".swap-images");
$(document)
	.on("mouseenter", ".swap-images", function () {
		var x = $(this);
		var t = $(this).find(".swap-image");
		if (t.attr("data-next")) {
			var nextSrc = t.attr("data-next");
			t.one("load", function () {
				x.addClass("hovered");
			});
			t.attr("src", nextSrc);
		}
	})
	.on("mouseleave", ".swap-images", function () {
		var x = $(this);
		var t = $(this).find(".swap-image");
		if (t.attr("data-next")) {
			var originalSrc = t.attr("data-src");
			t.one("load", function () {
				x.removeClass("hovered");
			});
			t.attr("src", originalSrc);
		}
	}); */


  // ========================================
  // PAGE-SPECIFIC CODE
  // ========================================
  // From: js/3_pages/category_filters.js
document.addEventListener("ShoptetDOMContentLoaded", () => {
	addToggleToFiltersHeadings();
	selectedFilters();
});

addToggleToFiltersHeadings();
selectedFilters();

function addToggleToFiltersHeadings() {
	if (!body.classList.contains("type-category")) {
		return;
	}

	let filters = document.querySelector("#filters");
	if (!filters) return;

	let headings = filters.querySelectorAll("h4");
	if (!headings || headings.length === 0) return;

	headings.forEach((heading) => {
		addToggle(heading);
	});

	function addToggle(heading) {
		heading.addEventListener("click", () => {
			headings.forEach((h) => {
				if (h !== heading) {
					h.parentElement.classList.remove("expanded");
				}
			});
			heading.parentElement.classList.toggle("expanded");
		});
	}
}

function selectedFilters() {
	let clearFiltersBtn = document.querySelector("#clear-filters");

	if (!clearFiltersBtn) return;

	let allFilterSections = document.querySelectorAll("#filters .filter-section");
	const selectedFiltersWrapper = document.createElement("div");
	selectedFiltersWrapper.className = "selected-filters-wrapper";

	const selectedFiltersContent = document.createElement("div");
	selectedFiltersContent.className = "selected-filters-content";

	selectedFiltersWrapper.appendChild(selectedFiltersContent);

	//cena
	let sliderWrapper = document.querySelector("#filters .slider-wrapper");
	if (sliderWrapper) {
		let priceSlider = sliderWrapper.querySelector("#slider");
		if (priceSlider && priceSlider.style.width !== "100%") {
			let minFilterValue = sliderWrapper.querySelector(".slider-header .from").textContent.trim();
			let maxFilterValue = sliderWrapper.querySelector(".slider-header .to").textContent.trim();

			minFilterValue = minFilterValue.replace(/  +/g, " ");
			maxFilterValue = maxFilterValue.replace(/  +/g, " ");

			console.log("minFilterValue", minFilterValue);
			console.log("maxFilterValue", maxFilterValue);

			const selectedFilterContainer = document.createElement("div");
			selectedFilterContainer.className = "selected-filter-container";

			const sliderHeader = sliderWrapper.querySelector("h4 > span");

			const selectedFilterHeading = document.createElement("div");
			selectedFilterHeading.className = "selected-filter-heading";
			selectedFilterHeading.textContent = sliderHeader.textContent;
			selectedFilterContainer.appendChild(selectedFilterHeading);

			const selectedFiltersList = document.createElement("div");
			selectedFiltersList.className = "selected-filters-list";

			const selectedFilterItem = document.createElement("div");
			selectedFilterItem.className = "selected-filter-item";
			selectedFilterItem.classList.add("price-range-item");
			selectedFilterItem.textContent = `${minFilterValue} - ${maxFilterValue}`;

			selectedFiltersList.appendChild(selectedFilterItem);
			selectedFilterContainer.appendChild(selectedFiltersList);
			selectedFiltersContent.appendChild(selectedFilterContainer);
		}
	}

	//parametry
	allFilterSections.forEach((section) => {
		let selectedInput = section.querySelectorAll("input[type='checkbox']:checked");
		if (selectedInput.length === 0) return;

		let filterHeading = section.querySelector("h4");
		if (!filterHeading) return;

		const selectedFilterContainer = document.createElement("div");
		selectedFilterContainer.className = "selected-filter-container";

		const selectedFilterHeading = document.createElement("div");
		selectedFilterHeading.className = "selected-filter-heading";
		selectedFilterHeading.textContent = filterHeading.textContent;
		selectedFilterContainer.appendChild(selectedFilterHeading);

		const selectedFiltersList = document.createElement("div");
		selectedFiltersList.className = "selected-filters-list";
		selectedInput.forEach((input) => {
			let label = input.parentElement.querySelector("label");
			if (!label) return;

			const selectedFilterItem = document.createElement("div");
			selectedFilterItem.className = "selected-filter-item";

			selectedFilterItem.textContent = label.childNodes[0].textContent.trim(); //textContent without .filter-count inside label

			selectedFilterItem.addEventListener("click", () => {
				input.click();
			});

			selectedFiltersList.appendChild(selectedFilterItem);
		});
		selectedFilterContainer.appendChild(selectedFiltersList);
		selectedFiltersContent.appendChild(selectedFilterContainer);
	});

	const selectedFiltersHeading = document.createElement("div");
	selectedFiltersHeading.className = "selected-filters-heading";
	selectedFiltersHeading.textContent = translationsStrings.selectedFilters[activeLang];
	selectedFiltersContent.prepend(selectedFiltersHeading);

	selectedFiltersContent.appendChild(clearFiltersBtn);
	let filtersWrapper = document.querySelector(".filters-wrapper");
	if (filtersWrapper) {
		filtersWrapper.appendChild(selectedFiltersWrapper);
	}
}


  // From: js/3_pages/category_move_elements.js
function editCategory() {
	if (!body.classList.contains("type-category")) {
		return;
	}

	let categotyTop = document.querySelector(".category-top");
	let contentWrapperIn = document.querySelector(".content-wrapper-in");
	if (contentWrapperIn && categotyTop) {
		contentWrapperIn.prepend(categotyTop);
	}

	let breadcrumbsWrapper = document.querySelector(".breadcrumbs-wrapper");
	if (categotyTop && breadcrumbsWrapper) {
		categotyTop.prepend(breadcrumbsWrapper);
	}
}

editCategory();

document.addEventListener("ShoptetDOMContentLoaded", () => {
	let categoryTopInContent = document.querySelector("#content .category-top");
	if (categoryTopInContent) {
		categoryTopInContent.remove();
	}
});


  // From: js/3_pages/index.js
function moveFooterBanners() {
	if (!body.classList.contains("in-index")) {
		return;
	}
	let footerBanners = document.querySelector(".footer-banners");
	if (!footerBanners) return;

	let homepageGroupTitles = document.querySelectorAll(".homepage-group-title");
	if (!homepageGroupTitles || homepageGroupTitles.length < 3) return;

	// insert footer banners before the 3rd homepage group title
	homepageGroupTitles[2].parentNode.insertBefore(footerBanners, homepageGroupTitles[2]);
}

moveFooterBanners();


})();
