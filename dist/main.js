// AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
// This file is automatically generated by build-js.js
// Run 'npm run dev:js' or 'npm run build:js' to regenerate

(function() {
  'use strict';

  // ========================================
  // GLOBAL VARIABLES & CONFIGURATION
  // ========================================
  // From: js/0_global/media_size.js
const mediaSizes = {
	desktop: 1280,
	smallTabletMax: 1023,
	tablet: 768,
};
let isMobile = false;
let isTablet = false;
let isSmallTablet = false;
let isDesktop = false;

checkMediaSizes();
document.addEventListener("resizeX", function () {
	checkMediaSizes();
});

function checkMediaSizes() {
	if (window.innerWidth < mediaSizes.tablet) {
		isMobile = true;
		isTablet = false;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.tablet && window.innerWidth < mediaSizes.desktop) {
		isMobile = false;
		isTablet = true;
		isDesktop = false;
	}
	if (window.innerWidth >= mediaSizes.desktop) {
		isMobile = false;
		isTablet = false;
		isDesktop = true;
	}
	if (window.innerWidth <= mediaSizes.smallTabletMax) {
		isSmallTablet = true;
	} else {
		isSmallTablet = false;
	}
}


  // From: js/0_global/translations.js
const translationsStrings = {
	phoneCode: {
		cs: "+420 ",
		sk: "+421 ",
		pl: "+48 ",
	},
	contactHours: {
		cs: "Po–Pá 8:00–16:00",
		sk: "Po–Pá 8:00–16:00",
		pl: "Pn–Pt 8:00–16:00",
	},
	showAllCategories: {
		cs: "Zobrazit další kategorie",
		sk: "Zobraziť ďalšie kategórie",
		pl: "Pokaż więcej kategorii",
	},
	moreButtonMoreThanFour: {
		cs: "dalších ",
		sk: "ďalších ",
		pl: "dalszych ",
	},
	moreButtonLessThanFour: {
		cs: "další ",
		sk: "ďalšie ",
		pl: "dalsze ",
	},
	more: {
		cs: "Více",
		sk: "Viac",
		pl: "Więcej",
	},
	moreThan: {
		cs: "více než ",
		sk: "viac ako ",
		pl: "więcej niż ",
	},
	cartTotalLabel: {
		cs: "Cena celkem",
		sk: "Cena spolu",
		pl: "Cena łącznie",
	},
	customFilterButton: {
		cs: "Filtrování výsledků",
		sk: "Filtrovanie výsledkov",
		pl: "Filtrowanie wyników",
	},
	selectedFilters: {
		cs: "Vybrané filtry",
		sk: "Vybrané filtre",
		pl: "Wybrane filtry",
	},
	product: {
		cs: "Produkt",
		sk: "Produkt",
		pl: "Produkt",
	},
	favorites: {
		cs: "Oblíbené",
		sk: "Obľúbené",
		pl: "Ulubione",
	},
	compare: {
		cs: "Porovnat",
		sk: "Porovnať",
		pl: "Porównaj",
	},

	verifiedReviews: {
		cs: "Ověřená hodnocení",
		sk: "Overené hodnotenia",
		pl: "Zweryfikowane opinie",
	},
	shopRatingUrl: {
		cs: "/hodnoceni-obchodu",
		sk: "/hodnotenie-obchodu",
		pl: "/opinie-o-sklepie",
	},
	noSaleCoupon: {
		cs: "U tohoto produktu není možné uplatnit slevový kód.",
		sk: "U tohto produktu nie je možné uplatniť zľavový kód.",
		pl: "U tego produktu nie można zastosować kodu rabatowego.",
	},
	iHaveSaleCoupon: {
		cs: "Mám slevový kód",
		sk: "Mám zľavový kód",
		pl: "Mam kod rabatowy",
	},
	noLoyaltySale: {
		cs: "U tohoto produktu není možné uplatnit věrnostní slevu.",
		sk: "U tohto produktu nie je možné uplatniť vernostnú zľavu.",
		pl: "U tego produktu nie można zastosować zniżki lojalnościowej.",
	},
	descriptionTitle: {
		cs: "Popis",
		sk: "Popis",
		pl: "Opis",
	},
	directionsTitle: {
		cs: "Dávkování",
		sk: "Dávkovanie",
		pl: "Dawkowanie",
	},
	ingredientsTitle: {
		cs: "Složení",
		sk: "Zloženie",
		pl: "Skład",
	},
	certificatesTitle: {
		cs: "Certifikáty",
		sk: "Certifikáty",
		pl: "Certyfikaty",
	},
	reviewsTitle: {
		cs: "Hodnocení",
		sk: "Hodnotenie",
		pl: "Opinie",
	},
	weSupportTitle: {
		cs: "Pomáháme",
		sk: "Pomáhame",
		pl: "Pomagamy",
	},
	relatedProductsTitle: {
		cs: "Související produkty",
		sk: "Súvisiace produkty",
		pl: "Produkty powiązane",
	},
	showRelatedProducts: {
		cs: "Zobrazit související produkty",
		sk: "Zobraziť súvisiace produkty",
		pl: "Pokaż produkty powiązane",
	},
	relatedFilesTitle: {
		cs: "Dokumenty",
		sk: "Dokumenty",
		pl: "Dokumenty",
	},
	show: {
		cs: "Zobrazit",
		sk: "Zobraziť",
		pl: "Pokaż",
	},
	showCertificate: {
		cs: "Zobrazit certifikát",
		sk: "Zobraziť certifikát",
		pl: "Pokaż certyfikat",
	},
	outOf: {
		cs: "z",
		sk: "z",
		pl: "z",
	},
	natiosDescription: {
		cs: "Natios je česká značka, která se zaměřuje na výrobu kvalitních doplňků stravy s čistým složením bez zbytečných příměsí, konzervantů a éček.",
		sk: "Natios je česká značka, ktorá sa zameriava na výrobu kvalitných doplnkov stravy s čistým zložením bez zbytočných prísad, konzervantov a éčok.",
		pl: "Natios to czeska marka, która koncentruje się na produkcji wysokiej jakości suplementów diety o czystym składzie – bez zbędnych domieszek, konserwantów i sztucznych dodatków (E).",
	},

	natiosSupportTextTop: {
		cs: "Nákupem <b>přispějete</b> 1 Kč dětské hematoonkologii.",
		sk: "Nákupom <b>prispievate</b> 1 Kč detskej hematoonkológii.",
		pl: "Kupując, <b>wspierasz</b> dziecięcą hematoonkologię kwotą 1 CZK.",
	},
	natiosSupportHeaderBottom: {
		cs: "<h3>Pomáháme</h3><span>&nbsp;dětské hematoonkologii</span>",
		sk: "<h3>Pomáhame</h3><span>&nbsp;detskej hematoonkológii</span>",
		pl: "<h3>Pomagamy</h3><span>&nbsp;pediatrycznej hematoonkologii</span>",
	},
	natiosSupportTextBottom: {
		cs: "Natios z každého prodaného produktu daruje 1 Kč dětské hematoonkologii ve Fakultní nemocnici v Ostravě. Léčba každého onkologického pacienta v České republice se odhaduje na přibližně 8&nbsp;000&nbsp;Kč měsíčně. Věříme tedy, že tímto krokem společně dokážeme pomoci několika rodinám.",
		sk: "Natios z každého predaného produktu daruje 1 Kč detskej hematoonkológii vo Fakultnej nemocnici v Ostrave. Liečba každého onkologického pacienta v České republice sa odhaduje na približne 8&nbsp;000&nbsp;Kč mesačne. Veríme teda, že týmto krokom spoločne dokážeme pomôcť niekoľkým rodinám.",
		pl: "Natios z każdego sprzedanego produktu przekazuje 1 CZK na rzecz pediatrycznej hematoonkologii w Szpitalu Uniwersyteckim w Ostrawie. Leczenie jednego pacjenta onkologicznego w Czechach szacuje się na około 8&nbsp;000&nbsp;CZK miesięcznie. Wierzymy, że tym krokiem wspólnie możemy pomóc wielu rodzinom.",
	},
	natiosSupportTotalAmount: {
		cs: "Společně jsme již dokázali přispět přes 650&nbsp;000&nbsp;Kč. Děkujeme!",
		sk: "Spoločne sme už dokázali prispieť cez 650&nbsp;000&nbsp;Kč. Ďakujeme!",
		pl: "Wspólnie udało nam się już przekazać ponad 650&nbsp;000&nbsp;CZK. Dziękujemy!",
	},
	natiosSupportBlogUrl: {
		cs: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		sk: "/blog/natios-pomaha-hematoonkologii-v-ostrave/",
		pl: "/",
	},
	natiosSupportPageUrl: {
		cs: "natios-pomaha-hematoonkologii-v-ostrave/",
		sk: "natios-pomaha-hematoonkologii-v-ostrave/",
		pl: "/",
	},
	moreAboutSupport: {
		cs: "Více o pomoci",
		sk: "Viac o pomoci",
		pl: "Więcej o pomocy",
	},
	insertFirstReview: {
		cs: "Vložit první hodnocení",
		sk: "Vložiť prvé hodnotenie",
		pl: "Wstaw pierwszą opinię",
	},
	watchDog: {
		cs: "Hlídat dostupnost",
		sk: "Strážiť dostupnosť",
		pl: "Obserwuj dostępność",
	},
	readMore: {
		cs: "Číst dále",
		sk: "Čítať ďalej",
		pl: "Czytaj dalej",
	},
	productVariants: {
		cs: "Varianty produktu",
		sk: "Varianty produktu",
		pl: "Warianty produktu",
	},
	showMoreVariants: {
		cs: "Zobrazit více variant",
		sk: "Zobraziť viac variantov",
		pl: "Pokaż więcej wariantów",
	},
	withVAT: {
		cs: "s DPH",
		sk: "s DPH",
		pl: "z VAT",
	},
	toCart: {
		cs: "Do košíku",
		sk: "Do košíka",
		pl: "Do koszyka",
	},
	alertMe: {
		cs: "Upozornit",
		sk: "Upozorniť",
		pl: "Powiadom",
	},
	buyMoreForFreeDelivery_1: {
		cs: "Nakupte ještě za",
		sk: "Nakúpte ešte za",
		pl: "Brakuje Ci jeszcze",
	},
	buyMoreForFreeDelivery_2: {
		cs: "a máte dopravu ZDARMA",
		sk: "a máte dopravu ZADARMO",
		pl: "do DARMOWEJ dostawy",
	},
	reachedFreeDelivery_1: {
		cs: "Máte dopravu",
		sk: "Máte dopravu",
		pl: "Zyskujesz dostawę",
	},
	reachedFreeDelivery_2: {
		cs: "ZDARMA!",
		sk: "ZADARMO!",
		pl: "GRATIS!",
	},
	gitFiltersUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/filters_pl.json",
	},
	followOnInstagram: {
		cs: "Sledujte nás na Instagramu",
		sk: "Sledujte nás na Instagrame",
		pl: "Śledź nas na Instagramie",
	},

	deliveryTime_1: {
		cs: "do",
		sk: "do",
		pl: "do",
	},

	deliveryTime_2: {
		cs: "u vás",
		sk: "u vás",
		pl: "u Ciebie",
	},

	freeGiftsHeader: {
		cs: "Dárky k objednávce",
		sk: "Darčeky k objednávke",
		pl: "Prezenty do zamówienia",
	},
	/* gitHeurekaReviewsUrl: {
		cs: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_cz.json",
		sk: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/heureka_reviews_sk.json",
		pl: "https://raw.githubusercontent.com/NatimaFilip/natima_eshop_files/refs/heads/main/data/ceneo_reviews_pl.json" 
	}, */
};


  // From: js/0_global/variables.js
/*--------------------------------------- Přepsání funkcí*/
function moveFilters() {}

let body = document.querySelector("body");

let shoptetDataLayer = dataLayer[0].shoptet;

let footer = document.querySelector("#footer");

const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth || 6;


  // ========================================
  // UTILITY FUNCTIONS
  // ========================================
  // From: js/1_utils/custom_resize.js
// Debounce function to limit the rate at which a function can fire
let resizeTimer;
let lastWindowWidth = window.innerWidth;

window.addEventListener("resize", function () {
	if (window.innerWidth !== lastWindowWidth) {
		document.dispatchEvent(new CustomEvent("resizeX"));

		clearTimeout(resizeTimer);
		resizeTimer = setTimeout(function () {
			lastWindowWidth = window.innerWidth;
			// Dispatch a custom event when X axis resize is complete
			console.log("CUSTOM EVENT DISPATCHED: debouncedResize");
			document.dispatchEvent(new CustomEvent("debouncedResize"));
		}, 250);
	}
});


  // From: js/1_utils/scroll_to_element.js
function scrollToElement(element) {
	const headerHeight = document.querySelector("#header").offsetHeight;
	window.scrollTo({
		top: element.getBoundingClientRect().top + window.pageYOffset - headerHeight,
		behavior: "smooth",
	});
}


  // From: js/1_utils/slider_custom.js
function inicializeSliderElement(sliderWrapper, sliderParent, sliderItem, customClass, itemForHeightForControls) {
	if (!sliderParent || !sliderItem || sliderItem.length === 0) {
		console.warn("inicializeSliderElement has been tried to be initialized with invalid parameters.");
		return;
	}

	if (!sliderWrapper) {
		const sliderWrapperElement = document.createElement("div");
		sliderWrapperElement.classList.add("slider-custom-wrapper");
		sliderParent.parentNode.insertBefore(sliderWrapperElement, sliderParent);
		sliderWrapperElement.appendChild(sliderParent);
		sliderWrapper = sliderWrapperElement;
	}
	sliderWrapper.classList.add(customClass, "slider-custom-wrapper");

	createControls();
	enableDragging();

	function createControls() {
		let initialControls = sliderWrapper.querySelectorAll(".carousel-control");
		if (initialControls && initialControls.length > 0) {
			initialControls.forEach((control) => control.remove());
		}

		const leftControl = document.createElement("div");
		leftControl.classList.add("carousel-control", "left", "hidden-control");
		leftControl.setAttribute("role", "button");
		leftControl.setAttribute("data-slide", "prev");

		const rightControl = document.createElement("div");
		rightControl.classList.add("carousel-control", "right");
		rightControl.setAttribute("role", "button");
		rightControl.setAttribute("data-slide", "next");

		sliderWrapper.appendChild(leftControl);
		sliderWrapper.appendChild(rightControl);

		leftControl.addEventListener("click", () => slide("left"));
		rightControl.addEventListener("click", () => slide("right"));

		setTopPositionOfControls();
		document.addEventListener("DOMContentLoaded", setTopPositionOfControls);
		window.addEventListener("resize", setTopPositionOfControls);

		function setTopPositionOfControls() {
			let heightItem;
			if (itemForHeightForControls) {
				heightItem = sliderItem[0].querySelector(itemForHeightForControls);
			} else {
				heightItem = sliderItem[0];
			}
			if (heightItem) {
				const style = window.getComputedStyle(heightItem);
				const marginTop = parseFloat(style.marginTop) || 0;
				const marginBottom = parseFloat(style.marginBottom) || 0;
				const heightOfItem = heightItem.offsetHeight || 0;
				const totalHeight = heightOfItem + marginTop + marginBottom;
				leftControl.style.top = totalHeight / 2 + "px";
				rightControl.style.top = totalHeight / 2 + "px";
				if (totalHeight === 0) {
					leftControl.style.top = "50%";
					rightControl.style.top = "50%";
				}
			} else {
				leftControl.style.top = "50%";
				rightControl.style.top = "50%";
			}
		}

		//if sliderParent is not scrollable hide controls
		if (sliderParent.scrollWidth <= sliderParent.clientWidth) {
			leftControl.classList.add("hidden-control");
			rightControl.classList.add("hidden-control");
		}
	}

	function slide(direction) {
		if (sliderParent.classList.contains("sliding")) return;
		sliderParent.classList.add("sliding");

		const numberOfItems = parseInt(getComputedStyle(sliderWrapper).getPropertyValue("--number-of-items")) || 1;
		const gapValue = parseInt(getComputedStyle(sliderParent).getPropertyValue("--gap")) || 0;
		const largeItemMultiplier =
			parseFloat(getComputedStyle(sliderWrapper).getPropertyValue("--width-multiplier-of-1st-item")) - 1 || 0;
		const nextItemPreview = parseInt(getComputedStyle(sliderWrapper).getPropertyValue("--next-item-preview")) || 0;

		let scrollAmount;
		/* 	if (sliderItem.length > 2) {
			scrollAmount =
				sliderItem[2]?.offsetWidth * numberOfItems +
					gapValue * (numberOfItems - largeItemMultiplier - 1) +
					nextItemPreview || 200;
			
		} else {
			scrollAmount =
				sliderItem[0]?.offsetWidth * numberOfItems +
					gapValue * (numberOfItems - largeItemMultiplier - 1) +
					nextItemPreview || 200;
		} */

		scrollAmount = sliderParent.offsetWidth - (nextItemPreview - gapValue);

		const to = direction === "left" ? sliderParent.scrollLeft - scrollAmount : sliderParent.scrollLeft + scrollAmount;

		sliderParent.scrollTo({ left: to, behavior: "smooth" });

		setTimeout(() => {
			sliderParent.classList.remove("sliding");
		}, 300);
	}

	function enableDragging() {
		let isDragging = false;
		let startX = 0;
		let startScrollLeft = 0;
		let moved = false;
		let activePointerId = null;
		let moveThreshold = 5; // px

		// Start drag
		const onPointerDown = (e) => {
			// Only primary button if mouse
			if (e.pointerType === "mouse" && e.button !== 0) return;

			isDragging = true;
			moved = false;
			activePointerId = e.pointerId;

			startX = e.clientX;
			startScrollLeft = sliderParent.scrollLeft;

			sliderParent.classList.add("grabbing");

			// Attach move/up/cancel to window for robust dragging
			window.addEventListener("pointermove", onPointerMove);
			window.addEventListener("pointerup", endDrag);
			window.addEventListener("pointercancel", endDrag);
			window.addEventListener("pointerleave", endDrag);
		};

		// Drag move
		const onPointerMove = (e) => {
			if (!isDragging || e.pointerId !== activePointerId) return;

			const dx = e.clientX - startX;
			if (Math.abs(dx) > moveThreshold) moved = true;
			sliderParent.scrollLeft = startScrollLeft - dx;

			e.preventDefault();
		};

		// End/cancel drag
		const endDrag = (e) => {
			if (e && activePointerId !== null && e.pointerId !== activePointerId) return;
			isDragging = false;
			activePointerId = null;
			sliderParent.classList.remove("grabbing");

			window.removeEventListener("pointermove", onPointerMove);
			window.removeEventListener("pointerup", endDrag);
			window.removeEventListener("pointercancel", endDrag);
			window.removeEventListener("pointerleave", endDrag);
		};

		// Suppress clicks if a drag happened (avoids accidental link/card clicks)
		const onClick = (e) => {
			if (moved) {
				e.preventDefault();
				e.stopPropagation();
				moved = false; // reset
			}
		};

		// Attach pointerdown to sliderWrapper so dragging works from wrapper or any child
		sliderWrapper.addEventListener("pointerdown", onPointerDown);
		sliderParent.addEventListener("click", onClick);

		function removeHiddenControl(element) {
			element.classList.remove("hidden-control");
		}
		function addHiddenControl(element) {
			element.classList.add("hidden-control");
		}

		let leftControl = sliderWrapper.querySelector(".carousel-control.left");
		let rightControl = sliderWrapper.querySelector(".carousel-control.right");
		if (leftControl && rightControl) {
			sliderParent.addEventListener("scroll", () => {
				if (sliderParent.scrollLeft <= 0) {
					addHiddenControl(leftControl);
				} else {
					removeHiddenControl(leftControl);
				}

				if (sliderParent.scrollLeft >= sliderParent.scrollWidth - sliderParent.clientWidth - 1) {
					addHiddenControl(rightControl);
				} else {
					removeHiddenControl(rightControl);
				}
			});
		}
	}
}

let allProductsBlocks = document.querySelectorAll(".products-block:not(.products-page)");
if (allProductsBlocks && allProductsBlocks.length > 0) {
	allProductsBlocks.forEach((block) => {
		let productsBlockItems = block.querySelectorAll(".product");
		inicializeSliderElement(null, block, productsBlockItems, "products-slider", "img");
	});
}


  // ========================================
  // COMPONENTS
  // ========================================
  // From: js/2_components/breadcrumbs.js
shortenBreadcrumbs();
function shortenBreadcrumbs() {
	let breadcrumbs = document.querySelector(".breadcrumbs");
	if (!breadcrumbs) {
		return;
	}
	const breadcrumbsSpans = Array.from(breadcrumbs.querySelectorAll("span[itemprop='itemListElement']"));
	if (breadcrumbsSpans.length <= 2) {
		breadcrumbs.classList.add("only-home");
	} else {
		breadcrumbs.classList.add("shortened");
	}
}


  // From: js/2_components/carousel.js
//body body contains in-index
if (body.classList.contains("in-index")) {
	carouselThumbnails();
	carouselSlideForMobile();
}

function carouselThumbnails() {
	let carousel = document.querySelector("#carousel");
	if (!carousel) return;

	let items = carousel.querySelectorAll(".item");

	if (!items || items.length === 0) return;

	const thumbNailsWrapper = document.createElement("div");
	thumbNailsWrapper.classList.add("carousel-thumbnails-wrapper");

	items.forEach((item, index) => {
		let thumbNail = item.querySelector(".item-thumbnail");
		if (thumbNail) {
			thumbNailsWrapper.appendChild(thumbNail);
			if (index === 0) {
				thumbNail.classList.add("active");
			}

			thumbNail.addEventListener("click", () => {
				if (thumbNail.classList.contains("active")) return;
				//remove active class from all thumbnails
				let allThumbnails = thumbNailsWrapper.querySelectorAll(".item-thumbnail");
				allThumbnails.forEach((thumb) => {
					thumb.classList.remove("active");
				});
				//add active class to clicked thumbnail
				thumbNail.classList.add("active");

				let allItems = carousel.querySelectorAll(".item");
				allItems.forEach((it) => {
					it.classList.remove("previous");

					if (it.classList.contains("active")) {
						it.classList.remove("active");
						it.classList.add("previous");
					}
				});
				item.classList.add("active");
			});
		}
	});
	carousel.appendChild(thumbNailsWrapper);
}

function carouselSlideForMobile() {
	let carousel = document.querySelector("#carousel");
	if (!carousel) return;

	let carouselInner = carousel.querySelector(".carousel-inner");
	if (!carouselInner) return;

	let carouselControlLeft = carousel.querySelector(".carousel-control.left");
	let carouselControlRight = carousel.querySelector(".carousel-control.right");
	if (!carouselControlLeft || !carouselControlRight) return;

	carouselControlLeft.classList.add("hidden");

	carouselControlLeft.addEventListener("click", () => {
		carouselInner.scrollBy({
			left: -carouselInner.clientWidth,
			behavior: "smooth",
		});
	});

	carouselControlRight.addEventListener("click", () => {
		carouselInner.scrollBy({
			left: carouselInner.clientWidth,
			behavior: "smooth",
		});
	});

	//event listener on scroll of carouselInner, if scroll to left is 0, hide left control, else show it
	carouselInner.addEventListener("scroll", () => {
		if (carouselInner.scrollLeft === 0) {
			carouselControlLeft.classList.add("hidden");
		} else {
			carouselControlLeft.classList.remove("hidden");
		}
		//if scroll to right is max, hide right control, else show it
		if (carouselInner.scrollLeft + carouselInner.clientWidth + 1 >= carouselInner.scrollWidth) {
			carouselControlRight.classList.add("hidden");
		} else {
			carouselControlRight.classList.remove("hidden");
		}
	});
}


  // From: js/2_components/cart_widget.js
function positionOfCartOnNavigation() {
	let cartWidget = document.querySelector("#cart-widget");
	let cartNavigationButton = document.querySelector("#header .cart-count");

	if (!cartWidget || !cartNavigationButton) {
		console.warn("Cart widget or cart navigation button not found.");
		return;
	}
	cartNavigationButton.addEventListener("mouseenter", function () {
		applyTopOfCartWidget();
	});
	cartNavigationButton.addEventListener("click", function () {
		applyTopOfCartWidget();
	});

	let navigation = document.querySelector("#header #navigation");

	function applyTopOfCartWidget() {
		let topPosition = cartNavigationButton.getBoundingClientRect().bottom;
		let rightPosition = window.innerWidth - cartNavigationButton.getBoundingClientRect().right - scrollbarWidth;
		cartWidget.style.top = topPosition + "px";
		cartWidget.style.right = rightPosition + "px";

		let bottomSpaceOfCartNavButton =
			navigation.getBoundingClientRect().bottom - cartNavigationButton.getBoundingClientRect().bottom;
		console.log(bottomSpaceOfCartNavButton);
		cartWidget.style.setProperty("--pad-top", bottomSpaceOfCartNavButton + "px");
	}
}

document.addEventListener("DOMContentLoaded", function () {
	positionOfCartOnNavigation();
});

/*------------------------------------------------- KOSIK WIDGET - cena celkem do widgetu*/

let firstLoadOfCartWidget = true;
let cartWidgetSaveContinueButtonCopy;
let priceAddedToCartWidget = false;

document.addEventListener("ShoptetDOMCartContentLoaded", function () {
	saveContinueButton();
	insertTotalPriceToCartWidget();
});

function saveContinueButton() {
	console.log("saveContinueButton called");
	if (firstLoadOfCartWidget) {
		console.log("First load of cart widget, saving continue button.");
		let cartWidgetContinueButton = document.querySelector("#cart-widget .cart-widget-button");
		if (cartWidgetContinueButton) {
			cartWidgetSaveContinueButtonCopy = cartWidgetContinueButton.cloneNode(true);
			firstLoadOfCartWidget = false;
			return;
		}
	}

	if (!cartWidgetSaveContinueButtonCopy) return;
	if (!firstLoadOfCartWidget) {
		console.log("Re-adding continue button to cart widget.");
		console.log(cartWidgetSaveContinueButtonCopy);
		let cartWidget = document.querySelector("#cart-widget");
		cartWidget.appendChild(cartWidgetSaveContinueButtonCopy);
	}
}

function insertTotalPriceToCartWidget() {
	let header = document.querySelector("#header");
	if (!header) {
		return;
	}
	let totalPrice = header.querySelector(".cart-price").textContent.trim();
	if (!totalPrice) {
		return;
	}

	let cartWidgetButton = document.querySelector("#cart-widget .cart-widget-button");
	if (!cartWidgetButton) {
		return;
	}

	let popupWidgetInner = document.querySelector("#cart-widget .cart-widget-inner");
	if (popupWidgetInner) {
		popupWidgetInner.appendChild(cartWidgetButton);
	}

	/* 	if (priceAddedToCartWidget) {
		const existingTotalPriceElement = cartWidgetButton.querySelector(".cart-total-price-wrapper");
		if (existingTotalPriceElement) {
			const totalPriceStrong = existingTotalPriceElement.querySelector(".cart-total-price");
			if (totalPriceStrong) {
				totalPriceStrong.innerHTML = totalPrice;
			}
		}
		return;
	} */

	let existingTotalPriceElement = cartWidgetButton.querySelector(".cart-total-price-wrapper");
	if (existingTotalPriceElement) {
		existingTotalPriceElement.remove();
	}

	const totalPriceInCartWidgetElement = document.createElement("div");
	totalPriceInCartWidgetElement.className = "cart-total-price-wrapper";

	const totalPriceStrong = document.createElement("strong");
	totalPriceStrong.className = "cart-total-price";
	totalPriceStrong.innerHTML = totalPrice;

	const totalPriceLabel = document.createElement("span");

	totalPriceLabel.innerHTML = translationsStrings.cartTotalLabel[activeLang];

	totalPriceInCartWidgetElement.appendChild(totalPriceLabel);
	totalPriceInCartWidgetElement.appendChild(totalPriceStrong);
	cartWidgetButton.appendChild(totalPriceInCartWidgetElement);
	priceAddedToCartWidget = true;
}

/*-------------------------------------- KOSIK WIDGET - na mobilu rovnou do kosiku*/
addCartWidgetToCartMobileListener();
function addCartWidgetToCartMobileListener() {
	let header = document.querySelector("#header");
	if (!header) {
		console.warn("Header not found.");
		return;
	}
	let cartButton = header.querySelector(".navigation-buttons");
	if (!cartButton) {
		console.warn("Cart button not found.");
		return;
	}
	let cartHrefA = cartButton.querySelector("a");
	if (!cartHrefA) {
		console.warn("Cart button href not found.");
		return;
	}
	let cartHref = cartHrefA.getAttribute("href");
	if (!cartHref) {
		console.warn("Cart button href is empty.");
		return;
	}

	cartButton.addEventListener("click", function (event) {
		if (!isDesktop) {
			console.log("Cart button clicked on mobile, redirecting to cart page.");
			event.preventDefault();
			window.location.href = cartHref;
		} else {
			console.log("Cart button clicked on desktop, no action needed.");
		}
	});
}


  // From: js/2_components/cbox.js
// Close colorbox when clicking outside content area
function setupColorboxClose() {
	const colorbox = document.querySelector("#colorbox");
	if (!colorbox || colorbox.hasAttribute("data-close-listener")) return;

	colorbox.setAttribute("data-close-listener", "true");

	colorbox.addEventListener("click", function (e) {
		const cboxContent = this.querySelector("#cboxContent");

		// Check if click is on colorbox, but not on cboxContent or its children
		if (e.target === this || !cboxContent.contains(e.target)) {
			const cboxClose = this.querySelector("#cboxClose");
			if (cboxClose) {
				cboxClose.click();
			}
		}
	});
}

// Try to setup immediately and periodically check
setupColorboxClose();
setInterval(setupColorboxClose, 500);


  // From: js/2_components/dklab_compare.js
/*Zmena default pozice kam se umistuje doplnek*/

if (typeof dkLabPorovnavacZboziDataLayer !== "undefined") {
	dkLabPorovnavacZboziDataLayer.template.classic.selectors.headerIconAddBefore =
		"#header .header-top .site-name-wrapper";

	if (isSmallTablet) {
		dkLabPorovnavacZboziDataLayer.template.classic.selectors.headerIconAddBefore =
			"#header .menu-helper .menu-level-1 > li:first-of-type";
	}
	dkLabPorovnavacZboziDataLayer.template.classic.selectors.detailAddLinkDivAfter =
		".product-top .social-buttons-wrapper .link-icons";

	document.addEventListener("debouncedResize", function () {
		dkLabPorovnavacZboziDataLayer.template.classic.selectors.headerIconAddBefore =
			"#header .header-top .site-name-wrapper";

		if (!isSmallTablet) {
			let existingCompInHeader = document.querySelector(
				"#header .menu-helper .menu-level-1 #dkLabComparerHeaderWrappper"
			);
			if (existingCompInHeader) {
				let headerTop = document.querySelector("#header .header-top");
				if (!headerTop) return;
				headerTop.prepend(existingCompInHeader);
			}
		}

		if (isSmallTablet) {
			dkLabPorovnavacZboziDataLayer.template.classic.selectors.headerIconAddBefore =
				"#header .menu-helper .menu-level-1 > li:first-of-type";

			let existingCompInHeader = document.querySelector(".header-top #dkLabComparerHeaderWrappper");
			if (existingCompInHeader) {
				let menuLevel1 = document.querySelector("#header .menu-helper .menu-level-1");
				if (!menuLevel1) return;
				menuLevel1.prepend(existingCompInHeader);
			}
		}
	});
}

/*zjisteni, kolik produktu je v porovnani*/
let lastEm = 0;
let compareLoadedFirstTime = true;
document.addEventListener("dkLabProductComparerHeaderChanged", function () {
	let compareInHeader = document.querySelector("#header #dkLabComparerHeaderWrappper");
	if (!compareInHeader) return;

	let compareSpan = compareInHeader.querySelector("span.dkLabComparerHeaderIconBtn");
	if (!compareSpan) return;

	const compareTextSpan = document.createElement("span");
	compareTextSpan.textContent = translationsStrings.compare[activeLang];
	compareSpan.prepend(compareTextSpan);

	let em = compareInHeader.querySelector("em");
	let emText = em ? em.textContent : "0";
	if (!em) {
		compareInHeader.classList.add("no-count");
	} else {
		compareInHeader.classList.remove("no-count");
	}

	compareSpan.addEventListener("click", function (e) {
		//dispatch event "CompareSpanClicked"
		const event = new Event("dkLabCompareHeaderIconClicked");
		document.dispatchEvent(event);
		console.log(
			"%c dkLabCompareHeaderIconClicked event dispatched ",
			"background: lime; color: black; padding: 5px 10px; font-weight: bold;"
		);
	});

	if (emText >= "2" && emText > lastEm && compareLoadedFirstTime === false) {
		compareSpan.click();
	}
	lastEm = emText;
	compareLoadedFirstTime = false;
});

document.addEventListener("dkLabCompareHeaderIconClicked", function () {
	// Wait for table to appear in colorbox
	const colorbox = document.querySelector("#colorbox");
	if (!colorbox) return;

	const observer = new MutationObserver((_, obs) => {
		let dkLabComparerTableDiv = document.querySelector("#dkLabComparerTableDiv");
		if (!dkLabComparerTableDiv) return;

		let dkLabComparerTable = dkLabComparerTableDiv.querySelector("table#dkLabComparerTable");
		if (!dkLabComparerTable) return;

		// Table found, disconnect observer and proceed
		obs.disconnect();

		// Transform table into grid layout
		transformTableToGrid(dkLabComparerTable, dkLabComparerTableDiv);
		setupCloseButtons();
	});

	observer.observe(colorbox, {
		childList: true,
		subtree: true,
	});

	function setupCloseButtons() {
		let closeBtnsInImage = document.querySelectorAll(".dkLabComparerImage >span");
		if (closeBtnsInImage && closeBtnsInImage.length > 0) {
			closeBtnsInImage.forEach((btn) => {
				btn.addEventListener("click", function () {
					const event = new Event("dkLabCompareCloseButtonClicked");
					document.dispatchEvent(event);
					console.log(
						"%c dkLabCompareCloseButtonClicked event dispatched ",
						"background: orange; color: black; padding: 5px 10px; font-weight: bold;"
					);

					// Wait for table to update after close button click
					const updateObserver = new MutationObserver((_, obs) => {
						let dkLabComparerTableDiv = document.querySelector("#dkLabComparerTableDiv");
						if (!dkLabComparerTableDiv) return;

						let dkLabComparerTable = dkLabComparerTableDiv.querySelector("table#dkLabComparerTable");
						if (!dkLabComparerTable) return;

						obs.disconnect();
						transformTableToGrid(dkLabComparerTable, dkLabComparerTableDiv);
						setupCloseButtons();
					});

					updateObserver.observe(colorbox, {
						childList: true,
						subtree: true,
					});
				});
			});
		}
	}
});

function transformTableToGrid(table, container) {
	const rows = Array.from(table.querySelectorAll("tr"));
	if (rows.length === 0) return;

	// Remove existing grid if it exists
	const existingGrid = container.querySelector(".dklab-comparer-grid");
	if (existingGrid) {
		return;
	}

	// Remove existing scroll controls if they exist
	const existingControls = container.querySelectorAll(".dklab-comparer-control");
	existingControls.forEach((control) => control.remove());

	// Get number of columns from the first row
	const columnCount = rows[0].querySelectorAll("td").length;

	// Find the image row (row with .dkLabComparerImage) and button row
	let imageRowIndex = -1;
	let buttonRowIndex = -1;

	rows.forEach((row, index) => {
		if (row.querySelector(".dkLabComparerImage")) {
			imageRowIndex = index;
		}
		if (row.querySelector("button.btn-cart")) {
			buttonRowIndex = index;
		}
	});

	// Create grid container
	const gridContainer = document.createElement("div");
	gridContainer.className = "dklab-comparer-grid";

	// Build grid template: first column 150px, rest are 260px with auto
	const gridColumns = ["180px"];
	for (let i = 1; i < columnCount; i++) {
		gridColumns.push("270px");
	}
	gridContainer.style.gridTemplateColumns = gridColumns.join(" ");

	// Reorder rows: image first, button last, others in between
	const orderedRows = [];

	if (imageRowIndex !== -1) {
		orderedRows.push(rows[imageRowIndex]);
	}

	rows.forEach((row, index) => {
		if (index !== imageRowIndex && index !== buttonRowIndex) {
			orderedRows.push(row);
		}
	});

	if (buttonRowIndex !== -1) {
		orderedRows.push(rows[buttonRowIndex]);
	}

	// Find price row index in orderedRows
	let priceRowIndex = -1;
	orderedRows.forEach((row, index) => {
		const cells = Array.from(row.querySelectorAll("td"));
		if (cells.some((cell) => cell.textContent.trim().match(/\d+\s*(Kč|zł|€|Eur)/))) {
			priceRowIndex = index;
		}
	});

	orderedRows.forEach((row, rowIndex) => {
		const cells = row.querySelectorAll("td");
		const hasImageCell = row.querySelector(".dkLabComparerImage");
		const hasProductName = row.querySelector(".dkLabComparerProductName");
		const hasPrice = Array.from(cells).some((cell) => cell.textContent.trim().match(/\d+\s*(Kč|zł|€|Eur)/));
		const hasButton = row.querySelector("button.btn-cart");

		const isFirstParameterRow = priceRowIndex !== -1 && rowIndex === priceRowIndex + 1;

		cells.forEach((cell, cellIndex) => {
			const gridItem = document.createElement("div");
			gridItem.className = "dklab-comparer-grid-item";
			gridItem.innerHTML = cell.innerHTML;

			// Preserve classes from original cell
			if (cell.className) {
				gridItem.classList.add(...cell.className.split(" "));
			}

			// Add no-bg class to first column
			if (cellIndex === 0) {
				gridItem.classList.add("no-bg");
			}

			// Add first-parameter class to first row after price row
			if (isFirstParameterRow) {
				gridItem.classList.add("first-parameter");
			}

			// Add dkLabComparerImage class to first column if row has image cells
			if (hasImageCell && cellIndex === 0) {
				gridItem.classList.add("dkLabComparerImage");
			}

			// Add class for product names
			if (cell.querySelector(".dkLabComparerProductName")) {
				gridItem.classList.add("dklab-comparer-product-name");
			}

			// Add dklab-comparer-product-name to first column if row has product names
			if (hasProductName && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-product-name");
			}

			// Add class for prices (detect currency symbols)
			const cellText = cell.textContent.trim();
			if (cellText.match(/\d+\s*(Kč|zł|€|Eur)/)) {
				gridItem.classList.add("dklab-comparer-price");
			}

			// Add dklab-comparer-price to first column if row has prices
			if (hasPrice && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-price");
			}

			// Add class for buttons
			if (cell.querySelector("button.btn-cart")) {
				gridItem.classList.add("dklab-comparer-button");
			}

			// Add dklab-comparer-button to first column if row has buttons
			if (hasButton && cellIndex === 0) {
				gridItem.classList.add("dklab-comparer-button");
			}

			gridContainer.appendChild(gridItem);
		});
	});

	// Replace table with grid
	table.style.display = "none";
	container.appendChild(gridContainer);

	// Add scroll controls if there's horizontal overflow
	addScrollControls(container);
}

function addScrollControls(container) {
	// Check if container has horizontal overflow
	const hasOverflow = container.scrollWidth > container.clientWidth;

	if (!hasOverflow) return;

	// Create left control
	const controlLeft = document.createElement("div");
	controlLeft.classList.add("dklab-comparer-control", "left");

	// Create right control
	const controlRight = document.createElement("div");
	controlRight.classList.add("dklab-comparer-control", "right");

	// Update controls visibility based on scroll position
	function updateControls() {
		const scrollLeft = container.scrollLeft;
		const maxScroll = container.scrollWidth - container.clientWidth;

		if (scrollLeft > 0) {
			controlLeft.style.opacity = "1";
			controlLeft.style.pointerEvents = "auto";
		} else {
			controlLeft.style.opacity = "0";
			controlLeft.style.pointerEvents = "none";
		}

		if (scrollLeft < maxScroll - 1) {
			controlRight.style.opacity = "1";
			controlRight.style.pointerEvents = "auto";
		} else {
			controlRight.style.opacity = "0";
			controlRight.style.pointerEvents = "none";
		}
	}

	// Scroll left
	controlLeft.addEventListener("click", function () {
		container.scrollBy({ left: -270, behavior: "smooth" });
	});

	// Scroll right
	controlRight.addEventListener("click", function () {
		container.scrollBy({ left: 270, behavior: "smooth" });
	});

	// Listen to scroll events
	container.addEventListener("scroll", updateControls);

	// Append controls
	container.appendChild(controlLeft);
	container.appendChild(controlRight);

	// Initial update
	updateControls();
}


  // From: js/2_components/dklab_favorites.js
/* document.addEventListener(
	"dkLabFavouriteProductsHeaderChanged",
	function () {
		let favoritesInHeader = document.querySelector("#header .navigation-buttons #dkLabFavHeaderWrapper");
		if (!favoritesInHeader) return;

		let headerTop = document.querySelector("#header .header-top");
		if (!headerTop) return;

		headerTop.appendChild(favoritesInHeader);
	},
	{ once: true }
); */

/*Zmena default pozice kam se umistuje doplnek*/
if (typeof dkLabOblibeneDataLayer !== "undefined") {
	dkLabOblibeneDataLayer.template.classic.selectors.headerIconAddBefore = "#header .header-top .site-name-wrapper";

	if (isSmallTablet) {
		dkLabOblibeneDataLayer.template.classic.selectors.headerIconAddBefore =
			"#header .menu-helper .menu-level-1 > li:first-of-type";
	}

	dkLabOblibeneDataLayer.template.classic.selectors.detailAddLinkDivAfter = ".p-image-wrapper .p-image .p-main-image";

	document.addEventListener("debouncedResize", function () {
		dkLabOblibeneDataLayer.template.classic.selectors.headerIconAddBefore = "#header .header-top .site-name-wrapper";

		if (!isSmallTablet) {
			let existingFavInHeader = document.querySelector("#header .menu-helper .menu-level-1 #dkLabFavHeaderWrapper");
			if (existingFavInHeader) {
				let headerTop = document.querySelector("#header .header-top");
				if (!headerTop) return;
				headerTop.prepend(existingFavInHeader);
			}
		}

		if (isSmallTablet) {
			dkLabOblibeneDataLayer.template.classic.selectors.headerIconAddBefore =
				"#header .menu-helper .menu-level-1 > li:first-of-type";

			let existingFavInHeader = document.querySelector(".header-top #dkLabFavHeaderWrapper");
			if (existingFavInHeader) {
				let menuLevel1 = document.querySelector("#header .menu-helper .menu-level-1");
				if (!menuLevel1) return;
				menuLevel1.prepend(existingFavInHeader);
			}
		}
	});
}

document.addEventListener("dkLabFavouriteProductsHeaderChanged", function () {
	let favoritesInHeader = document.querySelector("#header #dkLabFavHeaderWrapper");
	if (!favoritesInHeader) return;

	let favoritesHref = favoritesInHeader.querySelector("a");
	if (!favoritesHref) return;

	const favoritesSpan = document.createElement("span");
	favoritesSpan.textContent = translationsStrings.favorites[activeLang];
	favoritesHref.prepend(favoritesSpan);

	let em = favoritesInHeader.querySelector("em");
	if (!em) {
		favoritesInHeader.classList.add("no-count");
	} else {
		favoritesInHeader.classList.remove("no-count");
	}
});


  // From: js/2_components/footer_bottom.js
function footerBottomEdit() {
	if (!footer) return;

	let footerSocials = footer.querySelector(".footer-socials");
	if (!footerSocials) return;

	let footerBottom = footer.querySelector(".footer-bottom");
	if (!footerBottom) return;

	footerBottom.prepend(footerSocials);

	let signature = footer.querySelector("#signature");
	if (!signature) return;

	const spanAnd = document.createElement("span");
	spanAnd.textContent = " & ";
	signature.appendChild(spanAnd);

	const filipHosek = document.createElement("a");
	filipHosek.href = "https://partneri.shoptet.cz/profesionalove/filip-hosek/";
	filipHosek.target = "_blank";
	filipHosek.rel = "noopener";
	filipHosek.className = "footer-signature-filip-hosek";
	filipHosek.textContent = "Filip Hošek";
	signature.appendChild(filipHosek);
}
footerBottomEdit();


  // From: js/2_components/footer_instagram.js
function editFooterInstagram() {
	if (!footer) return;

	let iGFooterButton = footer.querySelector(".instagram-follow-btn a");
	if (!iGFooterButton) return;

	let iGFooterButtonLink = iGFooterButton.getAttribute("href");
	if (!iGFooterButtonLink) return;

	let iGHeading = footer.querySelector("h4");
	if (!iGHeading) return;

	let accountName = iGFooterButtonLink.split("https://www.instagram.com/")[1];
	if (accountName.endsWith("/")) {
		accountName = accountName.slice(0, -1);
	}

	const link = document.createElement("a");
	link.href = iGFooterButtonLink;
	link.target = "_blank";
	link.rel = "noopener";

	const followText = document.createElement("span");
	followText.className = "ig-follow-text";
	followText.textContent = translationsStrings.followOnInstagram[activeLang];

	const accountNameSpan = document.createElement("span");
	accountNameSpan.className = "ig-account-name";
	accountNameSpan.textContent = accountName;

	link.appendChild(followText);
	link.appendChild(document.createTextNode(" "));
	link.appendChild(accountNameSpan);

	iGHeading.innerHTML = "";
	iGHeading.appendChild(link);
}

editFooterInstagram();


  // From: js/2_components/go_top_btn.js
function goTopBtn() {
	const goTopBtn = document.querySelector(".goToTop__button");
	if (!goTopBtn) return;

	goTopBtn.addEventListener("click", (e) => {
		e.preventDefault();
		window.scrollTo({
			top: 0,
			behavior: "smooth",
		});
	});
}

document.addEventListener("DOMContentLoaded", () => {
	goTopBtn();
});
document.addEventListener("ShoptetDOMContentLoaded", () => {
	goTopBtn();
});


  // From: js/2_components/header.js
let topNavigationBar = document.querySelector(".top-navigation-bar");
if (topNavigationBar) {
	let headerTop = document.querySelector(".header-top");
	if (headerTop) {
		let projectPhone = topNavigationBar.querySelector(".project-phone");
		if (projectPhone) {
			headerTop.appendChild(projectPhone);

			const contactHours = document.createElement("span");
			contactHours.classList.add("opening-hours");
			contactHours.textContent = translationsStrings.contactHours[activeLang];
			projectPhone.appendChild(contactHours);
		}

		let loginBtn = topNavigationBar.querySelector(".top-nav-button");

		if (loginBtn) {
			headerTop.appendChild(loginBtn);
		}
	}
}

let initializedHamburgerMenu = false;
document.addEventListener("DOMContentLoaded", function () {
	hamburgerMenuLogic();
	copyFooterLinksToHeader();
	detectHeaderHeight();
	stickyHeaderAdjustments();
});

document.addEventListener("debouncedResize", function () {
	hamburgerMenuLogic();
	detectHeaderHeight();
});

function hamburgerMenuLogic() {
	if (initializedHamburgerMenu) return;

	if (!isSmallTablet) return;

	let menuHelper = document.querySelector(".menu-helper");
	if (!menuHelper) return;

	initializedHamburgerMenu = true;

	let menuHelperSpan = menuHelper.querySelector(":scope > span");

	menuHelperSpan.addEventListener("click", function () {
		body.classList.toggle("has-opened-hamburger-menu");

		if (!body.classList.contains("has-opened-hamburger-menu")) {
			closeOpenedExtLi();
			menuHelper.classList.remove("has-opened-menu-level-1");
		}
	});

	let allExt = menuHelper.querySelectorAll("li.ext");
	if (allExt.length > 0) {
		allExt.forEach(function (extLi) {
			const showMoreExtLiSpan = document.createElement("span");
			showMoreExtLiSpan.classList.add("show-more-ext-li");
			extLi.append(showMoreExtLiSpan);

			showMoreExtLiSpan.addEventListener("click", function (e) {
				e.stopPropagation();

				const isCurrentlyOpen = extLi.classList.contains("opened-ext-li");

				closeOpenedExtLi();
				menuHelper.classList.remove("has-opened-menu-level-1");

				if (!isCurrentlyOpen) {
					extLi.classList.add("opened-ext-li");
					menuHelper.classList.add("has-opened-menu-level-1");
				}
			});

			extLi.addEventListener("click", function (e) {
				if (
					extLi.classList.contains("opened-ext-li") &&
					!e.target.closest(".show-more-ext-li") &&
					!e.target.closest(".menu-level-2")
				) {
					closeOpenedExtLi();
					menuHelper.classList.remove("has-opened-menu-level-1");
				}
			});
		});
	}

	function closeOpenedExtLi() {
		let existingOpenedExtLi = menuHelper.querySelectorAll("li.opened-ext-li");
		if (existingOpenedExtLi.length > 0) {
			existingOpenedExtLi.forEach(function (openedLi) {
				openedLi.classList.remove("opened-ext-li");
			});
		}
	}
}

function detectHeaderHeight() {
	let header = document.querySelector("#header");
	if (!header) return;

	let headerHeight = header.offsetHeight;
	body.style.setProperty("--header-height", headerHeight + "px");
}

function copyFooterLinksToHeader() {
	let customerLinks = document.querySelector(".customer-links");
	let aboutUsLinks = document.querySelector(".about-us-links");
	let headerTopMenuLevel1 = document.querySelector("#header .menu-helper .menu-level-1");

	if (headerTopMenuLevel1) {
		if (customerLinks) {
			const customerLinksClone = customerLinks.cloneNode(true);
			customerLinksClone.classList.add("customer-links-clone");
			headerTopMenuLevel1.appendChild(customerLinksClone);
		}
	}
	if (headerTopMenuLevel1) {
		if (aboutUsLinks) {
			const aboutUsLinksClone = aboutUsLinks.cloneNode(true);
			aboutUsLinksClone.classList.add("about-us-links-clone");
			headerTopMenuLevel1.appendChild(aboutUsLinksClone);
		}
	}
}

function stickyHeaderAdjustments() {
	let header = document.querySelector("#header");
	if (!header) return;

	let lastScrollTop = 0;
	let scrollThreshold = header.offsetHeight / 2;
	let scrollDownThreshold = 20;
	let scrollUpThreshold = 20;

	window.addEventListener("scroll", function () {
		let currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;

		if (currentScrollTop > scrollThreshold) {
			if (currentScrollTop - lastScrollTop >= scrollDownThreshold) {
				body.classList.add("sticky-header-hidden");
			} else if (lastScrollTop - currentScrollTop >= scrollUpThreshold) {
				body.classList.remove("sticky-header-hidden");
			}
		} else {
			body.classList.remove("sticky-header-hidden");
		}

		lastScrollTop = currentScrollTop;
	});
}


  // From: js/2_components/header_left_to_free_shipping.js
let freeShippingElementCopy;

function createFreeShippingInfo() {
	if (!shoptetDataLayer?.cartInfo) return;

	const { freeShipping, leftToFreeShipping } = shoptetDataLayer.cartInfo;
	if (freeShipping == null) return;

	const navigationButtons = document.querySelector("#header .navigation-buttons");
	if (!navigationButtons) return;

	let freeShiippingElementPrevious = document.querySelector(".header-free-shipping-info");
	if (freeShiippingElementPrevious) {
		freeShiippingElementPrevious.remove();
	}

	const freeShippingElement = document.createElement("div");
	freeShippingElement.classList.add("header-free-shipping-info");

	const leftToFreeShippingPrice = leftToFreeShipping?.priceLeft;
	if (!leftToFreeShippingPrice) return;

	const leftToFreeShippingPriceFormatted = leftToFreeShipping?.formattedPrice;
	if (!leftToFreeShippingPriceFormatted) return;

	if (freeShipping || leftToFreeShippingPrice <= 0) {
		// Free shipping reached
		const textOne = document.createElement("span");
		textOne.classList.add("free-shipping-text-one");
		textOne.innerText = translationsStrings.reachedFreeDelivery_1[activeLang] + " ";

		const textTwo = document.createElement("span");
		textTwo.classList.add("free-shipping-text-two");
		textTwo.innerText = translationsStrings.reachedFreeDelivery_2[activeLang];

		freeShippingElement.appendChild(textOne);
		freeShippingElement.appendChild(textTwo);

		body.classList.add("has-free-shipping");
	} else {
		// Show amount left for free shipping
		body.classList.remove("has-free-shipping");

		const textOne = document.createElement("span");
		textOne.classList.add("free-shipping-text-one");
		textOne.innerText = translationsStrings.buyMoreForFreeDelivery_1[activeLang] + " ";

		const amount = document.createElement("b");
		amount.classList.add("free-shipping-amount");
		amount.innerText = leftToFreeShippingPriceFormatted;

		const textTwo = document.createElement("span");
		textTwo.classList.add("free-shipping-text-two");
		textTwo.innerText = translationsStrings.buyMoreForFreeDelivery_2[activeLang];

		textOne.appendChild(amount);
		freeShippingElement.appendChild(textOne);
		freeShippingElement.appendChild(textTwo);

		let percentageProgressToFreeShipping = 0;

		let cartTotal = shoptetDataLayer.cartInfo.getNoBillingShippingPrice.withVat || 0;

		let leftToFreeShippingRounded = Math.round(leftToFreeShippingPrice);
		cartTotal = Math.round(cartTotal);

		percentageProgressToFreeShipping =
			100 - Math.round((leftToFreeShippingRounded / (cartTotal + leftToFreeShippingRounded)) * 100);
		let cartWidget = document.querySelector("#cart-widget");
		if (cartWidget) {
			cartWidget.style.setProperty("--free-shipping-progress", percentageProgressToFreeShipping + "%");
		}

		let cartWrapperInOrder = document.querySelector("#cart-wrapper");
		if (cartWrapperInOrder) {
			cartWrapperInOrder.style.setProperty("--free-shipping-progress", percentageProgressToFreeShipping + "%");
		}
	}

	freeShippingElementCopy = freeShippingElement;

	navigationButtons.prepend(freeShippingElement);
}

function freeShippingInfoInCartWidghet() {
	if (!freeShippingElementCopy) return;

	let cartWitgetFreeShipping = document.querySelector("#cart-widget .cart-free-shipping");
	if (!cartWitgetFreeShipping) {
		return;
	}

	cartWitgetFreeShipping.innerHTML = freeShippingElementCopy.outerHTML;
}

createFreeShippingInfo();
document.addEventListener("ShoptetCartUpdated", function () {
	createFreeShippingInfo();
});

document.addEventListener("ShoptetDOMCartContentLoaded", function () {
	freeShippingInfoInCartWidghet();
});


  // From: js/2_components/measure_units_download.js
/*NEW MEASURE UNIT - JSON GITHUB*/
async function downloadAndSaveMeasureUnitFilter() {
	const url = translationsStrings.gitFiltersUrl[activeLang];
	const storageKey = "measureFilters";
	const expiryKey = "measureFilters_expiry_01";

	// Check if data is already in localStorage and not expired
	const now = Date.now();
	const expiry = localStorage.getItem(expiryKey);
	const cached = localStorage.getItem(storageKey);
	if (expiry && cached && now < parseInt(expiry)) {
		// Data is still valid
		console.log("Measure filters loaded from localStorage.");
		measureFiltersData = JSON.parse(cached);
		return;
	}

	// Fetch and save
	try {
		const response = await fetch(url);
		if (!response.ok) throw new Error("Network response was not ok");
		const data = await response.json();
		localStorage.setItem(storageKey, JSON.stringify(data));
		localStorage.setItem(expiryKey, (now + 24 * 60 * 60 * 1000).toString());
		console.log("Measure filters saved to localStorage.");
		measureFiltersData = data;
	} catch (error) {
		console.warn("Failed to fetch Measure filters:", error);
	}
}


  // From: js/2_components/measure_units_show.js
let singleMeasuringUnit = {};
if (csLang) {
	singleMeasuringUnit = {
		kapslí: "kapsle",
		tablet: "tableta",
		tobolek: "tobolka",
		tabletek: "tabletka",
		dávek: "dávka",
		dávky: "dávka",
		produkty: "produkt",
		produktů: "produkt",
	};
}
if (skLang) {
	singleMeasuringUnit = {
		kapsúl: "kapsula",
		kapsula: "kapsula",
		tabliet: "tableta",
		tablietek: "tabletka",
		dávok: "dávka",
		dávky: "dávka",
		produktov: "produkt",
		produkty: "produkt",
	};
}
if (plLang) {
	singleMeasuringUnit = {
		kapsułek: "kapsułka",
		kapsułki: "kapsułka",
		tabletek: "tableta",
		saszetek: "saszetka",
		pastylek: "pastylka",
		gumisiów: "gumiś",
		dawek: "dawka",
		produktów: "produkt",
		produkty: "produkt",
	};
}

async function measureUnitFromFiltersProducts() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	await downloadAndSaveMeasureUnitFilter();
	let productFilterData = measureFiltersData;
	if (!productFilterData || productFilterData.length === 0) {
		return; // No filter data available
	}

	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("product-edited-measure")) {
			return; // Skip if already processed
		}
		product.classList.add("product-edited-measure");
		let productCodeForFilter = product.querySelector("span[data-micro='sku']")?.textContent.trim();
		if (!productCodeForFilter) {
			console.warn("Product code not found for a product.");
			return;
		}

		let amountText = productFilterData.find((item) => item.code === productCodeForFilter)?.value;
		if (!amountText) {
			console.warn("No measure unit found for product code:", productCodeForFilter);
			return;
		}

		// Convert comma to dot, then extract the number and unit
		let normalizedAmountText = amountText.replace(",", ".").trim();

		// Extract the numeric part (including decimal)
		let productMeasureAmount = normalizedAmountText.match(/[\d.]+/) ? normalizedAmountText.match(/[\d.]+/)[0] : "";

		// Extract the unit part (letters and spaces after the number)
		let productMeasureUnit = normalizedAmountText.replace(/[\d.\s]+/, "").trim();

		/* 	let productMeasureAmount = amountText.replace(/[^\d]/g, ""); //keep only digits from the measure unit
		let productMeasureUnit = amountText.replace(/[\d\s]/g, ""); //keep only letters from the measure unit
 */
		let ratingsWrapper = product.querySelector(".ratings-wrapper");
		if (ratingsWrapper) {
			// Create a new span element to display the amount
			let measureUnitSpan = document.createElement("span");
			measureUnitSpan.className = "product-measure-unit";
			measureUnitSpan.textContent = amountText;

			// Append the amount span to the ratings wrapper
			ratingsWrapper.appendChild(measureUnitSpan);
		}

		const pricePerUnitDiv = document.createElement("div");
		pricePerUnitDiv.className = "product-price-per-unit";
		let prices = product.querySelector(".prices");

		let priceFinal = product.querySelector(".price-final strong");
		let priceFinalValue;

		if (priceFinal) {
			// Extract the text content, trim it, and remove everything but numbers
			priceFinalValue = priceFinal.textContent.trim().replace(/[^\d.,]/g, ""); // Keep only digits, commas, and dots
			priceFinalValue = parseFloat(priceFinalValue.replace(",", ".")).toFixed(2);
		}

		let pricePerUnit_Unit;

		let foundUnitMatch = false;

		// Iterate over the keys in the object
		for (let key in singleMeasuringUnit) {
			if (productMeasureUnit.includes(key)) {
				foundUnitMatch = true;
				pricePerUnit_Unit = singleMeasuringUnit[key];
				break; // Exit the loop once a match is found
			}
		}
		if (!foundUnitMatch) {
			// If no match is found, use the original measure unit
			pricePerUnit_Unit = productMeasureUnit;
		}

		const pricePerUnit_Value = priceFinalValue / productMeasureAmount;

		const pricePerUnit_ValueSpan = document.createElement("span");
		pricePerUnit_ValueSpan.className = "product-price-per-unit-value";

		if (csLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " Kč / 1 " + pricePerUnit_Unit;
		}
		if (skLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " € / 1 " + pricePerUnit_Unit;
		}
		if (plLang) {
			pricePerUnit_ValueSpan.textContent =
				pricePerUnit_Value.toFixed(2).replace(".", ",") + " zł / 1 " + pricePerUnit_Unit;
		}

		if (prices && pricePerUnitDiv) {
			prices.appendChild(pricePerUnitDiv);
			pricePerUnitDiv.appendChild(pricePerUnit_ValueSpan);
		}
	});
}

async function measureUnitFromFiltersDetail() {
	let priceAndButtonWrapper = document.querySelector(".price-and-button-wrapper");
	if (!priceAndButtonWrapper) {
		return; // No products found
	}

	let sku = document.querySelector(".p-code > span:nth-child(2)")?.textContent.trim();
	if (!sku) {
		return; // No SKU found
	}
	await downloadAndSaveMeasureUnitFilter();
	let productFilterData = measureFiltersData;
	if (!productFilterData || productFilterData.length === 0) {
		return; // No filter data available
	}

	let amountText = productFilterData.find((item) => item.code === sku)?.value;
	if (!amountText) {
		console.warn("No measure unit found for product code:", productCodeForFilter);
		return;
	}
	// Convert comma to dot, then extract the number and unit
	let normalizedAmountText = amountText.replace(",", ".").trim();

	// Extract the numeric part (including decimal)
	let productMeasureAmount = normalizedAmountText.match(/[\d.]+/) ? normalizedAmountText.match(/[\d.]+/)[0] : "";

	// Extract the unit part (letters and spaces after the number)
	let productMeasureUnit = normalizedAmountText.replace(/[\d.\s]+/, "").trim();

	let priceFinal = priceAndButtonWrapper.querySelector(".price-final");

	let priceFinalHolder = priceAndButtonWrapper.querySelector(".price-final-holder");
	let priceFinalValue;

	if (priceFinalHolder) {
		// Extract the text content, trim it, and remove everything but numbers
		priceFinalValue = priceFinalHolder.textContent.trim().replace(/[^\d.,]/g, ""); // Keep only digits, commas, and dots
		priceFinalValue = parseFloat(priceFinalValue.replace(",", ".")).toFixed(2);
	}

	let pricePerUnit_Unit;

	let foundUnitMatch = false;

	// Iterate over the keys in the object
	for (let key in singleMeasuringUnit) {
		if (productMeasureUnit.includes(key)) {
			foundUnitMatch = true;
			pricePerUnit_Unit = singleMeasuringUnit[key];
			break; // Exit the loop once a match is found
		}
	}
	if (!foundUnitMatch) {
		// If no match is found, use the original measure unit
		pricePerUnit_Unit = productMeasureUnit;
	}

	const pricePerUnit_Value = priceFinalValue / productMeasureAmount;

	const pricePerUnit_ValueSpan = document.createElement("span");
	pricePerUnit_ValueSpan.className = "product-price-per-unit-value";

	if (activeLang === "cs") {
		pricePerUnit_ValueSpan.textContent =
			pricePerUnit_Value.toFixed(2).replace(".", ",") + " Kč / 1 " + pricePerUnit_Unit;
	}
	if (activeLang === "sk") {
		pricePerUnit_ValueSpan.textContent =
			pricePerUnit_Value.toFixed(2).replace(".", ",") + " € / 1 " + pricePerUnit_Unit;
	}
	if (activeLang === "pl") {
		pricePerUnit_ValueSpan.textContent =
			pricePerUnit_Value.toFixed(2).replace(".", ",") + " zł / 1 " + pricePerUnit_Unit;
	}

	const pricePerUnitDiv = document.createElement("div");
	pricePerUnitDiv.className = "product-price-per-unit";
	priceFinal.appendChild(pricePerUnitDiv);
	pricePerUnitDiv.appendChild(pricePerUnit_ValueSpan);
}

let measureFiltersData = [];
measureUnitFromFiltersProducts();
document.addEventListener("ShoptetDOMContentLoaded", function (event) {
	measureUnitFromFiltersProducts();
});
document.addEventListener("luigiSearchDone", function (event) {
	measureUnitFromFiltersProducts();
});

if (body.classList.contains("type-product")) {
	document.addEventListener("priceAndButtonMoved", function (event) {
		measureUnitFromFiltersDetail();
	});
}


  // From: js/2_components/menu.js
/*-------------------------------------- MENU OVERFLOW DETECTION*/
let menuLevelOne = document.querySelector(".menu-level-1");

function createMenuHelper() {
	if (document.querySelector(".menu-helper-custom")) {
		return;
	}
	const menuHelperCustom = document.createElement("div");
	menuHelperCustom.className = "menu-helper-custom";

	const menuHelperCustomText = document.createElement("span");
	menuHelperCustom.appendChild(menuHelperCustomText);
	menuHelperCustomText.textContent = translationsStrings.more[activeLang];

	const menuHelperCustomSubmenu = document.createElement("ul");
	menuHelperCustomSubmenu.className = "menu-helper-custom-submenu";
	menuHelperCustom.appendChild(menuHelperCustomSubmenu);

	if (menuLevelOne) {
		menuLevelOne.appendChild(menuHelperCustom);
	}
}

function inicializeMenu() {
	createMenuHelper();
	let menuHelperCustom = document.querySelector(".menu-helper-custom");
	let menuHelperCustomSubmenu = menuHelperCustom.querySelector(".menu-helper-custom-submenu");
	if (!menuLevelOne || !menuHelperCustom || !menuHelperCustomSubmenu) {
		return;
	}

	if (isMobile) {
		let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
		for (let i = 0; i < menuLevelOneLis.length; i++) {
			menuHelperCustomSubmenu.prepend(menuLevelOneLis[menuLevelOneLis.length - 1 - i]);
		}
		menuHelperCustom.classList.add("active");
		return;
	}

	/*Initial state*/
	menuHelperCustom.classList.remove("active");
	menuHelperCustomSubmenu.querySelectorAll(":scope>li").forEach((li) => {
		menuLevelOne.appendChild(li);
	});
	menuLevelOne.appendChild(menuHelperCustom);
	let menuLevelOneLis = menuLevelOne.querySelectorAll(":scope>li:not(.menu-helper-custom)");
	let overflownItems = false;
	let overflownIndex = -1;
	const menuLevelOneWidth = menuLevelOne.offsetWidth;
	const menuHelperCustomWidth = menuHelperCustom.offsetWidth;
	let cumulativeWidth = 0;

	//Detect overflown items
	for (let i = 0; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		cumulativeWidth += li.offsetWidth;
		if (cumulativeWidth > menuLevelOneWidth) {
			overflownItems = true;
			overflownIndex = i;
			break;
		}
	}

	if (!overflownItems) {
		return;
	}

	//calculate if helper fits
	cumulativeWidth = menuHelperCustomWidth + cumulativeWidth;
	if (cumulativeWidth > menuLevelOneWidth) {
		overflownIndex = overflownIndex - 1;
	}

	//move overflown items to helper
	for (let i = overflownIndex; i < menuLevelOneLis.length; i++) {
		const li = menuLevelOneLis[i];
		menuHelperCustomSubmenu.appendChild(li);
	}
	menuHelperCustom.classList.add("active");
}

/*Edit menu-level-2 href and img*/
function editMenuLevel2() {
	let menusLevel2 = document.querySelectorAll("#header .menu-level-2");
	if (!menusLevel2 || menusLevel2.length === 0) {
		return;
	}

	menusLevel2.forEach((menu) => {
		let childrenLi = menu.querySelectorAll(":scope>li");
		if (!childrenLi || childrenLi.length === 0) {
			return;
		}
		childrenLi.forEach((li) => {
			let img = li.querySelector(":scope>a>img");
			if (img) {
				li.prepend(img);
			}
		});
	});
}

/*Move cart next to menu*/
function moveCartNextToMenu() {
	let cart = document.querySelector("#header .navigation-buttons");
	let navigation = document.querySelector("#header #navigation");
	if (cart && navigation) {
		navigation.appendChild(cart);
	}
}

document.addEventListener("DOMContentLoaded", function () {
	moveCartNextToMenu();
	inicializeMenu();
	editMenuLevel2();
});

document.addEventListener("debouncedResize", function () {
	inicializeMenu();
});


  // From: js/2_components/products_block_amount_to_cart.js
function addAmountToCartInProductsBlock() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("amount-to-cart-added")) {
			return; // Skip if already processed
		}
		product.classList.add("amount-to-cart-added");
		let productCodeForFilter = product.querySelector("span[data-micro='sku']")?.textContent.trim();
		if (!productCodeForFilter) {
			console.warn("Product code not found for a product.");
			return;
		}

		let pToolForm = product.querySelector(".p-tools form");
		if (!pToolForm) {
			console.warn("Add to cart form not found for product code:", productCodeForFilter);
			return;
		}
		const amountInput = document.createElement("span");
		amountInput.classList.add("quantity");
		amountInput.innerHTML = `
	
    <span class="increase-tooltip js-increase-tooltip" data-trigger="manual" data-container="body" data-original-title="Není možné zakoupit více než 999 ks." aria-hidden="true" role="tooltip" data-testid="tooltip">
    </span>

    <span class="decrease-tooltip js-decrease-tooltip" data-trigger="manual" data-container="body" data-original-title="Minimální množství, které lze zakoupit, je 1 ks." aria-hidden="true" role="tooltip" data-testid="tooltip">
    </span>
    <label>
        <input type="number" name="amount" value="1" class="amount" autocomplete="off" data-decimals="0" step="1" min="1" max="999" aria-label="Množství" data-testid="cartAmount" data-np-intersection-state="visible">
    </label>

    <button class="increase" type="button" aria-label="Zvýšit množství o 1" data-testid="increase">
            <span class="increase__sign">+</span>
    </button>

    <button class="decrease" type="button" aria-label="Snížit množství o 1" data-testid="decrease">
            <span class="decrease__sign">−</span>
    </button>

		`;
		pToolForm.appendChild(amountInput);
	});
}

addAmountToCartInProductsBlock();

document.addEventListener("ShoptetDOMContentLoaded", function () {
	addAmountToCartInProductsBlock();
});

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", function () {
	addAmountToCartInProductsBlock();
});


  // From: js/2_components/products_block_reviews_number.js
/*---------ACTION PRICE AND REVIEWS NUMBER*/
function productsBlockReviewsNumber() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("reviews-added")) {
			return; // Skip if already processed
		}
		product.classList.add("reviews-added");

		let starWrapper = product.querySelector(".stars-wrapper");
		if (starWrapper) {
			let reviewsNumber = starWrapper.getAttribute("data-micro-rating-count");
			if (reviewsNumber) {
				const reviewsNumberSpan = document.createElement("span");
				reviewsNumberSpan.className = "reviews-number";
				reviewsNumberSpan.innerHTML = reviewsNumber + "x";
				starWrapper.appendChild(reviewsNumberSpan);
			}
		}
	});
}

productsBlockReviewsNumber();

document.addEventListener("ShoptetDOMContentLoaded", function () {
	productsBlockReviewsNumber();
});

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", function () {
	productsBlockReviewsNumber();
});


  // From: js/2_components/products_block_standard_price.js
/*---------ACTION PRICE AND REVIEWS NUMBER*/
function productsBlockStandardPrice() {
	let allProductsInProductsBlock = document.querySelectorAll(".products-block .product");
	if (!allProductsInProductsBlock || allProductsInProductsBlock.length === 0) {
		return; // No products found
	}
	allProductsInProductsBlock.forEach((product) => {
		if (product.classList.contains("standard-price-moved")) {
			return; // Skip if already processed
		}
		product.classList.add("standard-price-moved");

		let standardPrice = product.querySelector(".flag-discount .price-standard");
		let finalPrice = product.querySelector(".price-final");
		if (standardPrice && finalPrice) {
			finalPrice.appendChild(standardPrice);
		}
	});
}

productsBlockStandardPrice();

document.addEventListener("ShoptetDOMContentLoaded", function () {
	productsBlockStandardPrice();
});

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", function () {
	productsBlockStandardPrice();
});


  // From: js/2_components/products_block_swap_images.js
const producsBlockImageWidth = "423";
const producsBlockImageHeight = "423";

function customSwapImages() {
	let swapImagesProducts = document.querySelectorAll(".products-block .swap-images");
	if (!swapImagesProducts || swapImagesProducts.length === 0) {
		return; // No products found
	}
	swapImagesProducts.forEach((product) => {
		if (product.parentElement.classList.contains("custom-swap-images-added")) {
			return; // Skip if already processed
		}
		product.parentElement.classList.add("custom-swap-images-added");

		let swapImage = product.querySelector(".swap-image");
		if (!swapImage) {
			console.warn("Swap image not found for a product.");
			return;
		}

		let swapImageA = product.querySelector("a.image");
		if (!swapImageA) {
			console.warn("Image link not found for a product.");
			return;
		}

		const customFirstImage = document.createElement("img");
		customFirstImage.classList.add("custom-first-image");
		customFirstImage.src = swapImage.getAttribute("data-src") || "";
		customFirstImage.setAttribute("data-src", swapImage.getAttribute("data-src") || "");
		customFirstImage.alt = swapImage.alt || "";
		customFirstImage.width = producsBlockImageWidth;
		customFirstImage.height = producsBlockImageHeight;
		customFirstImage.loading = "lazy";
		customFirstImage.fetchPriority = "low";

		const customSecondImage = document.createElement("img");
		customSecondImage.classList.add("custom-second-image");
		customSecondImage.src = swapImage.getAttribute("data-next") || swapImage.src || "";
		customSecondImage.alt = swapImage.alt || "";
		customSecondImage.width = producsBlockImageWidth;
		customSecondImage.height = producsBlockImageHeight;
		customSecondImage.loading = "lazy";
		customSecondImage.fetchPriority = "low";

		swapImage.remove();
		swapImageA.appendChild(customFirstImage);
		swapImageA.appendChild(customSecondImage);
	});
}
customSwapImages();

document.addEventListener("ShoptetDOMContentLoaded", function () {
	customSwapImages();
});

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", function () {
	customSwapImages();
});

/* // Remove old swap-images event handlers
$(document).off("mouseenter mouseleave", ".swap-images");
$(document)
	.on("mouseenter", ".swap-images", function () {
		var x = $(this);
		var t = $(this).find(".swap-image");
		if (t.attr("data-next")) {
			var nextSrc = t.attr("data-next");
			t.one("load", function () {
				x.addClass("hovered");
			});
			t.attr("src", nextSrc);
		}
	})
	.on("mouseleave", ".swap-images", function () {
		var x = $(this);
		var t = $(this).find(".swap-image");
		if (t.attr("data-next")) {
			var originalSrc = t.attr("data-src");
			t.one("load", function () {
				x.removeClass("hovered");
			});
			t.attr("src", originalSrc);
		}
	}); */


  // From: js/2_components/reset_focus.js
function resetFocus() {
	setTimeout(() => {
		if (document.activeElement && document.activeElement !== document.body) {
			document.activeElement.blur();
		}
	}, 1);
}

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", () => {
	resetFocus();
});


  // ========================================
  // PAGE-SPECIFIC CODE
  // ========================================
  // From: js/3_pages/acount_pages.js
if (body.classList.contains("customer-page")) {
	removeMojeFromSidebar();
	wrapAnyTable();
}

function removeMojeFromSidebar() {
	const sidebar = document.querySelector(".sidebar");
	if (!sidebar) return;

	const links = sidebar.querySelectorAll("li a");
	const excludedTexts = ["Moje slevy", "Moje hodnocení u produktů"];

	links.forEach((link) => {
		const text = link.textContent.trim();

		// Skip if it's one of the excluded texts
		if (excludedTexts.includes(text)) return;

		// Remove "Moje " from the beginning and trim
		if (text.startsWith("Moje ")) {
			let newText = text.replace(/^Moje\s+/, "").trim();
			// Capitalize first letter
			newText = newText.charAt(0).toUpperCase() + newText.slice(1);
			link.textContent = newText;
		}
	});
}

function wrapAnyTable() {
	const tables = document.querySelectorAll("table");
	tables.forEach((table) => {
		// Check if table content overflows

		const wrapper = document.createElement("div");
		wrapper.classList.add("table-wrapper");
		table.parentNode.insertBefore(wrapper, table);
		wrapper.appendChild(table);
	});
}


  // From: js/3_pages/brand_page.js
if (body.classList.contains("in-o-znacce-natios")) {
	copyCategoriesToBrandPage();
}
function copyCategoriesToBrandPage() {
	const categoriesSection = document.querySelector("#natios-categories");
	let categoryFromHeader = document.querySelectorAll("#header .menu-level-2");
	if (!categoriesSection || !categoryFromHeader || categoryFromHeader.length === 0) {
		return;
	}

	let categoryCopy = categoryFromHeader[0].cloneNode(true);
	categoriesSection.appendChild(categoryCopy);
	let menusLevelThree = categoryCopy.querySelectorAll(".menu-level-3");
	if (!menusLevelThree || menusLevelThree.length === 0) {
		return;
	}
	menusLevelThree.forEach((ul) => {
		ul.remove();
	});

	let arrowSectionDown = document.querySelector(".arrow-section-down");
	if (arrowSectionDown) {
		let secondSection = document.querySelector(".brand-page .full-width-wrapper:nth-of-type(2)");
		if (secondSection) {
			arrowSectionDown.addEventListener("click", () => {
				secondSection.scrollIntoView({ behavior: "smooth" });
			});
		}
	}
}


  // From: js/3_pages/category_filters.js
document.addEventListener("ShoptetDOMContentLoaded", () => {
	addToggleToFiltersHeadings();
	selectedFilters();
	listingSortingControls();
	addFilterToggleForMobile();
});

document.addEventListener("ShoptetDOMPageMoreProductsLoaded", () => {
	addToggleToFiltersHeadings();
	selectedFilters();
	listingSortingControls();
	addFilterToggleForMobile();
});

addToggleToFiltersHeadings();
selectedFilters();
listingSortingControls();
addFilterToggleForMobile();

function addToggleToFiltersHeadings() {
	if (!body.classList.contains("type-category")) {
		return;
	}

	let filters = document.querySelector("#filters");
	if (!filters) return;

	let headings = filters.querySelectorAll("h4");
	if (!headings || headings.length === 0) return;

	headings.forEach((heading) => {
		addToggle(heading);
	});

	function addToggle(heading) {
		heading.addEventListener("click", () => {
			headings.forEach((h) => {
				if (h !== heading) {
					h.parentElement.classList.remove("expanded");
				}
			});
			heading.parentElement.classList.toggle("expanded");
		});
	}
}

function selectedFilters() {
	let existingSelectedFiltersWrapper = document.querySelector(".selected-filters-wrapper");
	if (existingSelectedFiltersWrapper) {
		existingSelectedFiltersWrapper.remove();
	}
	let clearFiltersBtn = document.querySelector("#clear-filters");

	if (!clearFiltersBtn) return;

	let allFilterSections = document.querySelectorAll("#filters .filter-section");
	const selectedFiltersWrapper = document.createElement("div");
	selectedFiltersWrapper.className = "selected-filters-wrapper";

	const selectedFiltersContent = document.createElement("div");
	selectedFiltersContent.className = "selected-filters-content";

	selectedFiltersWrapper.appendChild(selectedFiltersContent);

	//cena
	let sliderWrapper = document.querySelector("#filters .slider-wrapper");
	if (sliderWrapper) {
		let priceSlider = sliderWrapper.querySelector("#slider");
		let priceSliderRange = sliderWrapper.querySelector(".ui-slider-range");
		if (priceSlider && priceSliderRange && priceSliderRange.style.width !== "100%") {
			let minFilterValue = sliderWrapper.querySelector(".slider-header .from").textContent.trim();
			let maxFilterValue = sliderWrapper.querySelector(".slider-header .to").textContent.trim();

			minFilterValue = minFilterValue.replace(/  +/g, " ");
			maxFilterValue = maxFilterValue.replace(/  +/g, " ");

			console.log("minFilterValue", minFilterValue);
			console.log("maxFilterValue", maxFilterValue);

			const selectedFilterContainer = document.createElement("div");
			selectedFilterContainer.className = "selected-filter-container";

			const sliderHeader = sliderWrapper.querySelector("h4 > span");

			const selectedFilterHeading = document.createElement("div");
			selectedFilterHeading.className = "selected-filter-heading";
			selectedFilterHeading.textContent = sliderHeader.textContent;
			selectedFilterContainer.appendChild(selectedFilterHeading);

			const selectedFiltersList = document.createElement("div");
			selectedFiltersList.className = "selected-filters-list";

			const selectedFilterItem = document.createElement("div");
			selectedFilterItem.className = "selected-filter-item";
			selectedFilterItem.classList.add("price-range-item");
			selectedFilterItem.textContent = `${minFilterValue} - ${maxFilterValue}`;

			selectedFiltersList.appendChild(selectedFilterItem);
			selectedFilterContainer.appendChild(selectedFiltersList);
			selectedFiltersContent.appendChild(selectedFilterContainer);
		}
	}

	//parametry
	allFilterSections.forEach((section) => {
		let selectedInput = section.querySelectorAll("input[type='checkbox']:checked");
		if (selectedInput.length === 0) return;

		let filterHeading = section.querySelector("h4");
		if (!filterHeading) return;

		const selectedFilterContainer = document.createElement("div");
		selectedFilterContainer.className = "selected-filter-container";

		const selectedFilterHeading = document.createElement("div");
		selectedFilterHeading.className = "selected-filter-heading";
		selectedFilterHeading.textContent = filterHeading.textContent;
		selectedFilterContainer.appendChild(selectedFilterHeading);

		const selectedFiltersList = document.createElement("div");
		selectedFiltersList.className = "selected-filters-list";
		selectedInput.forEach((input) => {
			let label = input.parentElement.querySelector("label");
			if (!label) return;

			const selectedFilterItem = document.createElement("div");
			selectedFilterItem.className = "selected-filter-item";

			selectedFilterItem.textContent = label.childNodes[0].textContent.trim(); //textContent without .filter-count inside label

			selectedFilterItem.addEventListener("click", () => {
				input.click();
			});

			selectedFiltersList.appendChild(selectedFilterItem);
		});
		selectedFilterContainer.appendChild(selectedFiltersList);
		selectedFiltersContent.appendChild(selectedFilterContainer);
	});

	const selectedFiltersHeading = document.createElement("div");
	selectedFiltersHeading.className = "selected-filters-heading";
	selectedFiltersHeading.textContent = translationsStrings.selectedFilters[activeLang];
	selectedFiltersContent.prepend(selectedFiltersHeading);

	selectedFiltersContent.appendChild(clearFiltersBtn);
	let filtersWrapper = document.querySelector(".filters-wrapper");
	if (filtersWrapper) {
		filtersWrapper.appendChild(selectedFiltersWrapper);
	}
}

function listingSortingControls() {
	let listingControls = document.querySelector(".listSorting__controls");
	if (!listingControls) return;

	let listingControlsLi = listingControls.querySelectorAll("li");
	if (!listingControlsLi || listingControlsLi.length === 0) return;

	listingControlsLi.forEach((li) => {
		let activeButton = li.querySelector(".listSorting__control--current");
		if (activeButton) {
			li.classList.add("active");
			li.addEventListener("click", () => {
				listingControls.classList.toggle("active");
			});
		}
	});
}

function addFilterToggleForMobile() {
	let filters = document.querySelector("#filters");
	if (!filters) return;

	let filterToggleBtn = document.createElement("div");
	filterToggleBtn.className = "custom-filter-toggle-btn";
	filterToggleBtn.textContent = translationsStrings.customFilterButton[activeLang];

	filters.prepend(filterToggleBtn);

	filterToggleBtn.addEventListener("click", () => {
		filters.classList.toggle("active");
	});
}


  // From: js/3_pages/category_move_elements.js
let perexTrimmedIsVisible;
function editCategory() {
	if (!body.classList.contains("type-category")) {
		return;
	}

	let categotyTop = document.querySelector(".category-top");
	let contentWrapperIn = document.querySelector(".content-wrapper-in");
	if (contentWrapperIn && categotyTop) {
		contentWrapperIn.prepend(categotyTop);
	}

	let breadcrumbsWrapper = document.querySelector(".breadcrumbs-wrapper");
	if (categotyTop && breadcrumbsWrapper) {
		categotyTop.prepend(breadcrumbsWrapper);
	}

	perexTrimmedIsVisible = false;
	if (isMobile) {
		trimPerex();
	}
}

editCategory();

document.addEventListener("ShoptetDOMContentLoaded", () => {
	let categoryTopInContent = document.querySelector("#content .category-top");
	if (categoryTopInContent) {
		categoryTopInContent.remove();
	}
});

function trimPerex() {
	const maxLength = 130;
	const perexElement = document.querySelector(".category-perex");
	if (!perexElement) return;

	const paragraphElement = perexElement.querySelector(":scope > p");
	if (!paragraphElement) return;

	let originalText = paragraphElement.textContent;
	originalText = originalText.replace(/\s+/g, " ").trim();

	if (originalText.length <= maxLength) {
		// If the text is already short enough, do nothing
		return;
	}
	perexElement.classList.add("category-perex-has-shortened");
	// Find the last full word within the maxLength
	let truncatedText = originalText.slice(0, maxLength);
	const lastSpaceIndex = truncatedText.lastIndexOf(" ");
	if (lastSpaceIndex !== -1) {
		truncatedText = truncatedText.slice(0, lastSpaceIndex);
	}

	const categoryPerexShortened = document.createElement("p");
	categoryPerexShortened.innerHTML = truncatedText;
	categoryPerexShortened.className = "category-perex-shortened";
	perexElement.appendChild(categoryPerexShortened);

	const readMoreButton = document.createElement("span");
	readMoreButton.className = "read-more-perex";

	readMoreButton.innerHTML = translationsStrings.more[activeLang];

	categoryPerexShortened.appendChild(readMoreButton);

	readMoreButton.addEventListener("click", function () {
		perexElement.classList.add("active");
		perexTrimmedIsVisible = true;
	});
	//make it so it trims after 3 lines and saves the rest of the text in a data attribute
}


  // From: js/3_pages/index.js
function moveFooterBanners() {
	if (!body.classList.contains("in-index")) {
		return;
	}
	let footerBanners = document.querySelector(".footer-banners");
	if (!footerBanners) return;

	let homepageGroupTitles = document.querySelectorAll(".homepage-group-title");
	if (!homepageGroupTitles || homepageGroupTitles.length < 3) return;

	// insert footer banners before the 3rd homepage group title
	homepageGroupTitles[2].parentNode.insertBefore(footerBanners, homepageGroupTitles[2]);
}

moveFooterBanners();


  // From: js/3_pages/ordering_process_0_repeating.js
if (body.classList.contains("ordering-process")) {
	document.addEventListener("DOMContentLoaded", function () {
		createWrapperForSummary();
		fetchImagesOfProductsInCart();
	});

	createWrapperForSummary();
}
async function fetchImagesOfProductsInCart() {
	let itemNames = document.querySelectorAll(".cart-item .cart-item-name");
	if (!itemNames) return;

	itemNames.forEach(async (itemName) => {
		let productLink = itemName.querySelector("a");
		if (!productLink) return;

		const imageBlock = document.createElement("div");
		imageBlock.classList.add("image-block");
		itemName.parentElement.prepend(imageBlock);

		let productUrl = productLink.href;

		try {
			let response = await fetch(productUrl);
			/* let response = await fetch(window.location.origin + productUrl); */

			if (!response.ok) throw new Error("Network response was not ok");

			let html = await response.text();

			// Parse the HTML string into a document
			let parser = new DOMParser();
			let doc = parser.parseFromString(html, "text/html");

			// Get the image element
			let img = doc.querySelector(".p-main-image > img");

			if (img) {
				// Clone the image so it can be used in the current DOM
				let newImg = document.createElement("img");
				newImg.src = img.src.replace("/big/", "/detail/");
				newImg.alt = img.alt || "";

				// Prepend to itemName
				itemName.parentElement.querySelector(".image-block").append(newImg);
			}
		} catch (error) {
			console.error("There has been a problem with your fetch operation:", error);
		}
	});
}

function createWrapperForSummary() {
	let cartSummary = document.querySelector("#checkoutSidebar .cart-content");
	if (!cartSummary) return;

	let cartSummaryPrevious = document.querySelector(".cart-summary-wrapper");

	let summaryWrapper = document.createElement("div");
	summaryWrapper.classList.add("cart-summary-wrapper");
	if (!cartSummaryPrevious) {
		cartSummary.appendChild(summaryWrapper);
	}
	if (cartSummaryPrevious) {
		summaryWrapper = cartSummaryPrevious;
	}

	let recapitulationSingles = document.querySelectorAll(".recapitulation-single");
	recapitulationSingles.forEach((element) => {
		summaryWrapper.appendChild(element);
	});

	let orderSummaryHelper = document.querySelector(".order-summary-item.helper");
	if (orderSummaryHelper) {
		summaryWrapper.appendChild(orderSummaryHelper);
	}

	let orderPriceSummary = document.querySelector(".order-summary-item.price");
	if (orderPriceSummary) {
		summaryWrapper.appendChild(orderPriceSummary);
	}

	let nextStep = document.querySelector(".next-step");
	if (nextStep) {
		summaryWrapper.appendChild(nextStep);

		let consents = document.querySelectorAll(".consents");
		if (consents && consents.length > 0) {
			consents.forEach((consent) => {
				nextStep.appendChild(consent);
			});
		}
	}
}


  // From: js/3_pages/ordering_process_1.js
if (body.classList.contains("id--9")) {
	moveAvaiabilityAmount();
	avaiabilityAndDeliveryWrapperCart();
	moveGiftsCart();
	moveCartSummaryToSidebar();
	addCheckboxToCouponField();
	giftSelectCustom();

	document.addEventListener("ShoptetDOMCartContentLoaded", () => {
		moveAvaiabilityAmount();
		avaiabilityAndDeliveryWrapperCart();
		moveGiftsCart();
		moveCartSummaryToSidebar();
		addCheckboxToCouponField();
		giftSelectCustom();
	});
}

function moveAvaiabilityAmount() {
	let pAvailabilities = document.querySelectorAll(".cart-table .p-availability");
	if (!pAvailabilities || !pAvailabilities.length) return;

	pAvailabilities.forEach((pAvailability) => {
		let amount = pAvailability.querySelector(".availability-amount");
		if (!amount) return;

		let label = pAvailability.querySelector(".availability-label");
		if (!label) return;

		label.appendChild(amount);
	});
}

function avaiabilityAndDeliveryWrapperCart() {
	let pAvailabilities = document.querySelectorAll(".cart-table .p-availability");
	if (!pAvailabilities || !pAvailabilities.length) return;

	let deliveryTime = document.querySelector(".delivery-time .show-tooltip");

	if (deliveryTime) {
		editDeliveryDateTextCart(deliveryTime);

		pAvailabilities.forEach((pAvailability) => {
			const availabilityAndDeliveryWrapper = document.createElement("div");
			availabilityAndDeliveryWrapper.classList.add("availability-and-delivery-wrapper");

			const deliveryTimeCloned = deliveryTime.cloneNode(true);

			availabilityAndDeliveryWrapper.appendChild(deliveryTimeCloned);
			pAvailability.appendChild(availabilityAndDeliveryWrapper);
		});
	}
}
function editDeliveryDateTextCart(deliveryTime) {
	const deliveryText1 = document.createElement("span");
	deliveryText1.classList.add("delivery-text-1");
	deliveryText1.textContent = translationsStrings.deliveryTime_1[activeLang] + " ";

	const deliveryText2 = document.createElement("span");
	deliveryText2.classList.add("delivery-text-2");
	deliveryText2.textContent = " " + translationsStrings.deliveryTime_2[activeLang];

	deliveryTime.prepend(deliveryText1);
	deliveryTime.appendChild(deliveryText2);
}

function moveGiftsCart() {
	let gifts = document.querySelector(".free-gift");
	let cartWrapper = document.querySelector("#cart-wrapper");
	if (gifts && cartWrapper) {
		cartWrapper.append(gifts);
	}
	let extraGift = document.querySelector(".extra.gift");
	if (extraGift && cartWrapper && !gifts) {
		const extraGiftWrapper = document.createElement("div");
		extraGiftWrapper.classList.add("free-gifts-wrapper");

		const extraGiftContainer = document.createElement("div");
		extraGiftContainer.classList.add("free-gift");
		extraGiftWrapper.appendChild(extraGift);

		extraGiftContainer.appendChild(extraGiftWrapper);
		cartWrapper.append(extraGiftContainer);
	}

	let freeGiftsWrapper = document.querySelector(".free-gifts-wrapper");
	if (freeGiftsWrapper) {
		let giftsHeader = document.createElement("h2");
		giftsHeader.classList.add("free-gifts-header");
		giftsHeader.textContent = translationsStrings.freeGiftsHeader[activeLang];
		freeGiftsWrapper.prepend(giftsHeader);
	}
}

function giftSelectCustom() {
	document.querySelectorAll(".free-gifts-wrapper .free-gifts label").forEach((label) => {
		label.addEventListener("click", function (event) {
			event.preventDefault();
			const forId = label.getAttribute("for");
			document.querySelectorAll(".free-gifts input").forEach((input) => {
				input.checked = input.id === forId;
			});
			const form = document.querySelector(".free-gifts-wrapper form");
			if (form && window.shoptet && shoptet.cart && typeof shoptet.cart.ajaxSubmitForm === "function") {
				shoptet.cart.ajaxSubmitForm(form.getAttribute("action"), form, "functionsForCart", "cart", true);
			}
		});
	});
}

function moveCartSummaryToSidebar() {
	let cartSummary = document.querySelector(".cart-summary");
	let sidebar = document.querySelector(".sidebar-in-cart");
	if (cartSummary && sidebar) {
		sidebar.append(cartSummary);
	}
}

function addCheckboxToCouponField() {
	let couponField = document.querySelector(".discount-coupon");
	if (!couponField) return;

	couponField.classList.add("disabled");

	const checkboxWrapper = document.createElement("div");
	checkboxWrapper.classList.add("coupon-checkbox-wrapper");
	const checkbox = document.createElement("input");
	checkbox.type = "checkbox";
	checkbox.id = "coupon-checkbox";
	checkbox.classList.add("coupon-checkbox-input");
	const label = document.createElement("label");
	label.htmlFor = "coupon-checkbox";
	label.classList.add("coupon-checkbox-label");
	label.textContent = translationsStrings.iHaveSaleCoupon[activeLang];

	checkboxWrapper.appendChild(checkbox);
	checkboxWrapper.appendChild(label);
	couponField.prepend(checkboxWrapper);

	checkbox.addEventListener("change", function () {
		if (this.checked) {
			couponField.classList.remove("disabled");
		} else {
			couponField.classList.add("disabled");
		}
	});
}


  // From: js/3_pages/ordering_process_2.js
if (body.classList.contains("id--16")) {
	let deliveryMethodWrapper = document.querySelector(".co-delivery-method");
	let paymentMethodWrapper = document.querySelector(".co-payment-method");

	document.addEventListener("DOMContentLoaded", function () {
		disableInputs(deliveryMethodWrapper);
		disableInputs(paymentMethodWrapper);
		removeDeliveryFromRecap();
		removePaymentFromRecap();
	});

	document.addEventListener("ShoptetShippingMethodUpdated", function () {
		let activeDeliveryMethod = document.querySelector("#order-shipping-methods > .radio-wrapper.active");
		let activePaymentMethod = document.querySelector("#order-billing-methods > .radio-wrapper.active");

		if (!activePaymentMethod) {
			setTimeout(() => {
				removePaymentFromRecap();
				disableInputs(paymentMethodWrapper);
			}, 200);
		}

		if (activeDeliveryMethod) {
			paymentMethodWrapper.classList.remove("disabled");
			deliveryMethodWrapper.classList.add("selected");
		} else {
			deliveryMethodWrapper.classList.remove("selected");
		}
	});
}

function disableInputs(method) {
	if (!method) return;
	let allInputs = method.querySelectorAll("input");

	if (!allInputs) return;
	allInputs.forEach((input) => {
		input.checked = false;
		input.parentElement.classList.remove("active");
	});
}

function removeDeliveryFromRecap() {
	let recapText = document.querySelector(".recapitulation-shipping-billing .recapitulation-shipping-billing-info");
	if (recapText) {
		if (csLang) {
			recapText.textContent = "Zvolte způsob dopravy";
		}
		if (skLang) {
			recapText.textContent = "Zvoľte spôsob dopravy";
		}
		if (plLang) {
			recapText.textContent = "Wybierz sposób dostawy";
		}
	}
}
function removePaymentFromRecap() {
	let recapText = document.querySelector(".recapitulation-shipping-billing.last .recapitulation-shipping-billing-info");
	if (recapText) {
		if (csLang) {
			recapText.textContent = "Zvolte způsob platby";
		}
		if (skLang) {
			recapText.textContent = "Zvoľte spôsob platby";
		}
		if (plLang) {
			recapText.textContent = "Wybierz sposób płatności";
		}
	}
}


  // From: js/3_pages/ordering_process_3.js
if (body.classList.contains("id--17")) {
	createGridSystemInOrderThree();
}

function createGridSystemInOrderThree() {
	let coContactInformation = document.querySelector(".co-contact-information");
	let coBillingAddress = document.querySelector(".co-billing-address");

	let cartHeader = document.querySelector(".cart-header");

	if (!coContactInformation || !coBillingAddress || !cartHeader) return;

	let movingObjects = [coContactInformation, coBillingAddress];

	const customGridSystemOrderThree = document.createElement("div");
	customGridSystemOrderThree.classList.add("custom-grid-system-order-three");

	movingObjects.forEach((element) => {
		const customGridElement = document.createElement("div");
		customGridElement.classList.add("custom-grid-element-order-three");

		let gridHeader = element.querySelector("h4");
		if (gridHeader) {
			customGridElement.appendChild(gridHeader);
		}

		customGridElement.appendChild(element);
		customGridSystemOrderThree.appendChild(customGridElement);
	});
	cartHeader.insertAdjacentElement("afterend", customGridSystemOrderThree);

	let addNote = document.querySelector("#add-note");
	if (addNote) {
		coContactInformation.appendChild(addNote.parentElement.parentElement);
	}

	let companyShopping = document.querySelector("#company-shopping");
	if (companyShopping) {
		coBillingAddress.appendChild(companyShopping.parentElement);
	}

	let companyInfo = document.querySelector("#company-info");
	if (companyInfo) {
		coBillingAddress.appendChild(companyInfo);
	}

	let anotherShipping = document.querySelector("#another-shipping");
	if (anotherShipping) {
		coBillingAddress.appendChild(anotherShipping.parentElement);
	}
	let shippingAdress = document.querySelector("#shipping-address");
	if (shippingAdress) {
		coBillingAddress.appendChild(shippingAdress);
	}
}


  // From: js/3_pages/product_product_top.js
function moveElementProductTop() {
	let productTop = document.querySelector(".product-top");
	let pImageWrapper = document.querySelector(".p-image-wrapper");
	let pInfoWrapper = document.querySelector(".p-info-wrapper");

	if (!productTop || !pImageWrapper || !pInfoWrapper) {
		console.warn("Required elements for moving product top are missing.");
		return;
	}

	let reviewAndCodeWrapper = document.createElement("div");
	reviewAndCodeWrapper.classList.add("review-and-code-wrapper");
	let starsWrapperTop = document.querySelector(".stars-wrapper");
	if (starsWrapperTop) {
		addNumberOfReviewsToProductTop(starsWrapperTop);
		reviewAndCodeWrapper.appendChild(starsWrapperTop);
	}
	let productCode = document.querySelector(".p-detail-inner .p-code");
	if (productCode) {
		reviewAndCodeWrapper.appendChild(productCode);
	}

	let pDetailInnerHeader = document.querySelector(".p-detail-inner-header");
	if (pDetailInnerHeader) {
		pDetailInnerHeader.append(reviewAndCodeWrapper);
	}

	addSupportToImageWrapper(pImageWrapper);

	productTopDependingOnDevice(productTop, pImageWrapper, pInfoWrapper);
	document.addEventListener("debouncedResize", function () {
		productTopDependingOnDevice(productTop, pImageWrapper, pInfoWrapper);
	});

	addParametrersToProductTop(pInfoWrapper);
	avaiabilityAndDeliveryWrapper(productTop, pInfoWrapper);
	priceAndButtonWrapper(productTop, pInfoWrapper);
	readMoreDescription(productTop, pInfoWrapper);
	moveFlagsToImageWrapper(productTop, pImageWrapper);
	addListenerToThumbnails(pImageWrapper);
}

if (body.classList.contains("type-product")) {
	moveElementProductTop();

	document.addEventListener("DOMContentLoaded", function () {
		let thumbnailsWrapper = document.querySelector(".p-thumbnails-inner");
		let thumbnailsParent = document.querySelector(".p-thumbnails-inner > div");
		let thumbnails = document.querySelectorAll(".p-thumbnail");
		if (thumbnails && thumbnailsParent && thumbnailsWrapper) {
			inicializeSliderElement(thumbnailsWrapper, thumbnailsParent, thumbnails, "thumbnails-slider", null);
		}
	});
}

function productTopDependingOnDevice(productTop, pImageWrapper, pInfoWrapper) {
	if (isSmallTablet) {
		console.log("--------------NOW");
		let breadCrumbsWrapper = document.querySelector(".breadcrumbs-wrapper");
		if (breadCrumbsWrapper) {
			let header = document.querySelector("#header");
			if (header) {
				//insert breadcrumbs after header
				header.after(breadCrumbsWrapper);
			}
		}
		let productH1 = document.querySelector(".p-info-wrapper h1");
		if (productH1) {
			let pDetailInnerHeader = document.querySelector(".p-detail-inner-header");
			if (pDetailInnerHeader) {
				pDetailInnerHeader.prepend(productH1);
			}
		}

		let reviewAndCodeWrapper = document.querySelector(".p-info-wrapper .review-and-code-wrapper");
		if (reviewAndCodeWrapper) {
			let pDetailInnerHeader = document.querySelector(".p-detail-inner-header");
			if (pDetailInnerHeader) {
				pDetailInnerHeader.appendChild(reviewAndCodeWrapper);
			}
		}
		let pCode = document.querySelector(".review-and-code-wrapper .p-code");
		if (pCode) {
			pInfoWrapper.appendChild(pCode);
		}

		let productImageSupportElement = pImageWrapper.querySelector(".product-image-support-element");
		if (productImageSupportElement) {
			pInfoWrapper.appendChild(productImageSupportElement);
		}
	}

	if (!isSmallTablet) {
		let breadCrumbsWrapper = document.querySelector(".overall-wrapper > .breadcrumbs-wrapper");
		if (breadCrumbsWrapper) {
			pInfoWrapper.prepend(breadCrumbsWrapper);
		}
		let productH1 = document.querySelector(".p-detail-inner h1");
		if (productH1) {
			pInfoWrapper.prepend(productH1);
		}

		let reviewAndCodeWrapper = document.querySelector(".review-and-code-wrapper");
		if (reviewAndCodeWrapper) {
			pInfoWrapper.appendChild(reviewAndCodeWrapper);
			let pCode = pInfoWrapper.querySelector(".p-code");
			if (pCode) {
				reviewAndCodeWrapper.appendChild(pCode);
			}
		}

		let productImageSupportElement = pInfoWrapper.querySelector(".product-image-support-element");
		if (productImageSupportElement) {
			pImageWrapper.appendChild(productImageSupportElement);
		}
	}
}

function addNumberOfReviewsToProductTop(starsWrapperTop) {
	let starElement = starsWrapperTop.querySelector(".star");
	if (!starElement) {
		return;
	}
	let starsScore = starElement.getAttribute("title") || starElement.getAttribute("data-original-title");

	if (starsScore) {
		starsScore = starsScore.split(":")[1].split("/")[0].trim();
		starsScore = parseFloat(starsScore).toFixed(2).replace(".", ",");
		if (starsScore != null && starsScore != "NaN") {
			const starsScoreElement = document.createElement("div");
			starsScoreElement.className = "stars-score";
			starsScoreElement.innerHTML = `<span class="stars-score-text">${starsScore}</span> / 5`;
			starsWrapperTop.appendChild(starsScoreElement);
		} else {
			starsWrapperTop.classList.add("no-score");
			if (ratingTab) {
				ratingTab.classList.add("no-score");
			}
			let starsLabel = starsWrapperTop.querySelector(".stars-label");
			if (starsLabel) {
				starsLabel.textContent = translationsStrings.insertFirstReview[activeLang];
			}
		}
	}
}

function addParametrersToProductTop(pInfoWrapper) {
	let detailParameters = document.querySelector(".extended-description .detail-parameters");
	if (!detailParameters) {
		return;
	}
	let ratingTab = document.querySelector("#ratingTab");
	if (ratingTab) {
		//insert detail parameters after rating tab
		ratingTab.after(document.querySelector(".extended-description"));
	}

	const parametersToMove = detailParameters.querySelectorAll("tr");
	if (!parametersToMove || parametersToMove.length === 0) {
		return;
	}

	const detailParametersTop = document.createElement("div");
	detailParametersTop.classList.add("detail-parameters-top");

	parametersToMove.forEach((parameter, index) => {
		console.log("Processing parameter:", parameter, "at index:", index);
		if (index > 4) {
			const parameterWrapper = document.createElement("div");
			parameterWrapper.classList.add("parameter-wrapper");

			const parameterName = document.createElement("div");
			parameterName.classList.add("parameter-name");
			parameterName.textContent = parameter.querySelector("th").textContent.replace(":", "");

			const parameterValue = document.createElement("div");
			parameterValue.classList.add("parameter-value");
			parameterValue.textContent = parameter.querySelector("td").textContent;

			parameterWrapper.appendChild(parameterName);
			parameterWrapper.appendChild(parameterValue);
			detailParametersTop.appendChild(parameterWrapper);
		}
	});
	pInfoWrapper.appendChild(detailParametersTop);
}

function avaiabilityAndDeliveryWrapper(productTop, pInfoWrapper) {
	const availabilityAndDeliveryWrapper = document.createElement("div");
	availabilityAndDeliveryWrapper.classList.add("availability-and-delivery-wrapper");

	let availabilityValue = document.querySelector(".availability-value");
	if (availabilityValue) {
		editAvaiabilityText(availabilityValue);
		availabilityAndDeliveryWrapper.appendChild(availabilityValue);
	}

	let deliveryTime = productTop.querySelector(".delivery-time");
	if (deliveryTime) {
		editDeliveryDateText(deliveryTime);
		availabilityAndDeliveryWrapper.appendChild(deliveryTime);
	}
	pInfoWrapper.appendChild(availabilityAndDeliveryWrapper);
}

function editAvaiabilityText(availabilityValue) {
	let availabilityAmount = availabilityValue.querySelector(".availability-amount");
	if (!availabilityAmount) {
		return;
	}
	availabilityAmount.textContent = availabilityAmount.textContent.replace("(", "").replace(")", "").trim();
	availabilityAmount.textContent = availabilityAmount.textContent
		.replace(">", translationsStrings.moreThan[activeLang])
		.trim();
}

function editDeliveryDateText(deliveryTime) {
	const deliveryText1 = document.createElement("span");
	deliveryText1.classList.add("delivery-text-1");
	deliveryText1.textContent = translationsStrings.deliveryTime_1[activeLang] + " ";

	const deliveryText2 = document.createElement("span");
	deliveryText2.classList.add("delivery-text-2");
	deliveryText2.textContent = " " + translationsStrings.deliveryTime_2[activeLang];

	deliveryTime.prepend(deliveryText1);
	deliveryTime.appendChild(deliveryText2);
}

function priceAndButtonWrapper(productTop, pInfoWrapper) {
	const priceAndButtonWrapperWrapper = document.createElement("div");
	priceAndButtonWrapperWrapper.classList.add("price-and-button-wrapper-wrapper");

	const priceAndButtonWrapper = document.createElement("div");
	priceAndButtonWrapper.classList.add("price-and-button-wrapper");

	priceAndButtonWrapperWrapper.appendChild(priceAndButtonWrapper);
	pInfoWrapper.appendChild(priceAndButtonWrapperWrapper);

	let priceStandard = pInfoWrapper.querySelector(".price-standard");
	if (priceStandard) {
		priceAndButtonWrapper.appendChild(priceStandard);
	} else {
		priceAndButtonWrapper.classList.add("no-standard-price");
	}

	let priceFinal = pInfoWrapper.querySelector(".price-final");
	if (priceFinal) {
		const withVatInfo = document.createElement("span");
		withVatInfo.classList.add("with-vat-info");
		withVatInfo.textContent = translationsStrings.withVAT[activeLang];
		priceFinal.appendChild(withVatInfo);
		priceAndButtonWrapper.appendChild(priceFinal);
	}

	let quantity = pInfoWrapper.querySelector(".quantity");
	if (quantity) {
		priceAndButtonWrapper.appendChild(quantity);
	}

	let addToCartButton = pInfoWrapper.querySelector(".add-to-cart-button");
	if (addToCartButton) {
		priceAndButtonWrapper.appendChild(addToCartButton);
	}

	//dispatch event after moving price and button
	const event = new Event("priceAndButtonMoved");
	document.dispatchEvent(event);
	console.log(
		"%c priceAndButtonMoved event dispatched ",
		"background: lime; color: black; padding: 5px 10px; font-weight: bold;"
	);
}

function readMoreDescription(productTop, pInfoWrapper) {
	let readMoreDescriptionBtn = productTop.querySelector("p[data-testid='productCardDescr']");
	let socialButtonsWrapper = productTop.querySelector(".social-buttons-wrapper");

	if (readMoreDescriptionBtn && socialButtonsWrapper) {
		let readMoreDescriptionBtnA = readMoreDescriptionBtn.querySelector("a");
		if (readMoreDescriptionBtnA) {
			readMoreDescriptionBtnA.textContent = translationsStrings.readMore[activeLang];
		}
		socialButtonsWrapper.appendChild(readMoreDescriptionBtn);
	}
}

function moveFlagsToImageWrapper(productTop, pImageWrapper) {
	let flagsDefault = productTop.querySelector(".flags-default");
	let pImage = pImageWrapper.querySelector(".p-image");
	if (flagsDefault && pImage) {
		pImage.appendChild(flagsDefault);
	}
}

function addListenerToThumbnails(pImageWrapper) {
	let thumbnails = pImageWrapper.querySelectorAll(".p-thumbnail");
	if (!thumbnails || thumbnails.length === 0) {
		return;
	}
	let pMainImage = pImageWrapper.querySelector(".p-main-image");
	if (!pMainImage) {
		return;
	}
	thumbnails.forEach((thumbnail, index) => {
		thumbnail.addEventListener("click", function (event) {
			if (index !== 0) {
				pMainImage.classList.add("no-first-image");
			} else {
				pMainImage.classList.remove("no-first-image");
			}
		});
	});
}

function addSupportToImageWrapper(pImageWrapper) {
	const supportElement = document.createElement("div");
	supportElement.classList.add("product-image-support-element");

	const supportText = document.createElement("span");
	supportText.classList.add("support-text");
	supportText.innerHTML = translationsStrings.natiosSupportTextTop[activeLang];

	const supportLink = document.createElement("a");
	supportLink.classList.add("support-link");
	supportLink.href = translationsStrings.natiosSupportPageUrl[activeLang];
	supportLink.textContent = translationsStrings.more[activeLang];

	supportElement.appendChild(supportText);
	supportElement.appendChild(supportLink);

	pImageWrapper.appendChild(supportElement);
}


  // From: js/3_pages/product_related.js
function moveRelatedProducts() {
	let relatedProducts = document.querySelector(".products-related");

	let productsRelatedHeader = document.querySelector(".products-related-header");
	let tabContent = document.querySelector("#tab-content");
	if (relatedProducts && productsRelatedHeader && tabContent) {
		if (relatedProducts.parentElement.classList.contains("products-slider")) {
			relatedProducts = relatedProducts.parentElement;
		}

		tabContent.appendChild(productsRelatedHeader);
		tabContent.appendChild(relatedProducts);
	}
}

if (body.classList.contains("type-product")) {
	moveRelatedProducts();
}


  // From: js/3_pages/product_related_files.js
function moveRelatedFilesToAnalysis() {
	let relatedFiles = document.querySelector("#relatedFiles");
	if (!relatedFiles) return;

	const natiosAnalysis = document.querySelector(".product-widgets .natios-analysis .natios-analysis-content-left");
	if (natiosAnalysis) {
		let allHrefsInRelatedFiles = relatedFiles.querySelectorAll("a:not(.btn)");
		if (allHrefsInRelatedFiles && allHrefsInRelatedFiles.length > 0) {
			allHrefsInRelatedFiles.forEach((a) => {
				// Remove any text in parentheses with "kB" or "MB" etc.
				a.textContent = a.textContent.replace(/\(\s*[\d.,]+\s*[kMGT]?B\s*\)/gi, "").trim();
			});
		}
		natiosAnalysis.appendChild(relatedFiles);
		const showTestsButton = natiosAnalysis.querySelector(".show-tests-button");
		if (showTestsButton) {
			showTestsButton.remove();
		}
	}
	/*Zatím nic*/
	/* else {
		const basicDescription = document.querySelector("#description .basic-description");
		if (basicDescription) {
			basicDescription.insertAdjacentElement("afterend", relatedFiles);
		}
	} */
}

if (body.classList.contains("type-product")) {
	moveRelatedFilesToAnalysis();
}


  // From: js/3_pages/product_reviews.js
function productReviews() {
	let ratingTab = document.querySelector("#ratingTab");
	let rateForm = document.querySelector("#rate-form");
	let rateWrap = document.querySelector("#ratingTab .rate-wrap");

	if (!ratingTab || !rateForm || !rateWrap) return;

	rateWrap.appendChild(rateForm);

	let rateAverageWrap = ratingTab.querySelector(".rate-average-wrap");
	if (rateAverageWrap) {
		const ratingHeader = document.createElement("h3");
		ratingHeader.classList.add("rating-header");
		ratingHeader.textContent = translationsStrings.reviewsTitle[activeLang];
		rateAverageWrap.prepend(ratingHeader);
	}

	let starsWrapper = document.querySelector(".product-top .stars-wrapper");
	if (starsWrapper) {
		starsWrapper.addEventListener("click", function (event) {
			event.preventDefault();
			scrollToElement(ratingTab);
		});
	}
}

if (body.classList.contains("type-product")) {
	productReviews();
}


  // From: js/3_pages/product_supporting_bottom.js
function natiosSupportingBottom() {
	const natiosLargeBrandBlock = document.createElement("div");
	natiosLargeBrandBlock.className = "natios-support-wrapper";
	natiosLargeBrandBlock.innerHTML =
		'<div class="natios-support-icon"><img src="https://cdn.myshoptet.com/usr/www.natima.cz/user/documents/upload/NatiosDarujeFNO_2.svg" alt="Natios Charity" width="174" height="174"></div><div class="natios-support-wrapper-content"><div class="natios-support-wrapper-content-title">' +
		translationsStrings.natiosSupportHeaderBottom[activeLang] +
		" </div><p>" +
		translationsStrings.natiosSupportTextBottom[activeLang] +
		"</p><p>" +
		translationsStrings.natiosSupportTotalAmount[activeLang] +
		'</p><p><a href="' +
		translationsStrings.natiosSupportBlogUrl[activeLang] +
		'">' +
		translationsStrings.moreAboutSupport[activeLang] +
		"</a></p></div>";

	let manufacturerDescription = document.querySelector("#manufacturerDescription");
	console.log(manufacturerDescription);

	if (manufacturerDescription) {
		manufacturerDescription.after(natiosLargeBrandBlock);
	}
}

if (body.classList.contains("type-product")) {
	natiosSupportingBottom();
}


  // From: js/3_pages/product_table_explanation.js
function analysisTableExplanation() {
	const analysisContentRight = document.querySelector(".natios-analysis-content-right");
	if (!analysisContentRight) return;

	analysisContentRight.classList.add("test-element");

	let currentUl = null;
	let currentActiveFourthTd = null;

	// 1) Global clearer: runs BEFORE bubbling handlers (capture phase)
	document.addEventListener(
		"click",
		(e) => {
			if (currentUl) {
				const clickedInsideUl = currentUl.contains(e.target);
				const td = e.target.closest("td");
				const insideanalysisContentRight = analysisContentRight.contains(e.target);
				const isFourthTd = !!td && td.cellIndex === 3;
				const isFifthTd = !!td && td.cellIndex === 4;

				// keep open if clicking the floating UL itself
				if (clickedInsideUl) return;
				// let the container handler manage clicks on a 4th td
				if (insideanalysisContentRight && isFourthTd) return;
				// ignore clicks on a 5th td inside the container
				if (insideanalysisContentRight && isFifthTd) return;

				// Otherwise remove currentUl and clear active state
				currentUl.remove();
				currentUl = null;
				if (currentActiveFourthTd) {
					currentActiveFourthTd.classList.remove("active");
					currentActiveFourthTd = null;
				}
			}
		},
		true
	);

	// 2) Inside-container logic: activate the 5th td's UL when 4th td is clicked
	analysisContentRight.addEventListener("click", (e) => {
		const td = e.target.closest("td");
		if (!td || !analysisContentRight.contains(td)) return;

		const isFourthTd = td.cellIndex === 3; // zero-based
		if (isFourthTd) {
			// Toggle behavior: if clicking the same active 4th td, close it
			if (currentActiveFourthTd === td) {
				if (currentUl) {
					currentUl.remove();
					currentUl = null;
				}
				td.classList.remove("active");
				currentActiveFourthTd = null;
				return;
			}

			// Clear any existing open UL and active 4th td
			if (currentUl) {
				currentUl.remove();
				currentUl = null;
			}
			if (currentActiveFourthTd) {
				currentActiveFourthTd.classList.remove("active");
				currentActiveFourthTd = null;
			}

			const fifthTd = td.parentElement.querySelector("td:nth-child(5)");
			if (!fifthTd) return;

			const ul = fifthTd.querySelector("ul");
			if (!ul) return;

			// clone and append the ul to body
			currentUl = ul.cloneNode(true);
			currentUl.style.position = "absolute";
			currentUl.classList.add("active-table-explanation");

			// position it relative to the 4th td clicked
			const rect = td.getBoundingClientRect();
			currentUl.style.top = rect.bottom + window.scrollY - rect.height - 5 + "px";
			currentUl.style.right = window.innerWidth - rect.right - window.scrollX + "px";

			document.body.appendChild(currentUl);

			// mark the 4th td as active
			td.classList.add("active");
			currentActiveFourthTd = td;
		}
	});
}

if (body.classList.contains("type-product")) {
	analysisTableExplanation();
}


  // From: js/3_pages/product_tabs.js
function productNavigationCustom() {
	let detailTabs = document.querySelector("#p-detail-tabs");
	console.log("-------------------------------");
	console.log("detailTabs:", detailTabs);
	if (!detailTabs) {
		return; // Exit if detail tabs are not found
	}
	let shpTabs = document.querySelectorAll(".shp-tab");
	if (shpTabs && shpTabs.length > 0) {
		shpTabs.forEach((tab) => {
			tab.remove();
		});
	}

	createTabForSection("#description", translationsStrings.descriptionTitle[activeLang], true, detailTabs);

	createTabForSection(
		".product-widget[widget-type='directions']",
		translationsStrings.directionsTitle[activeLang],
		false,
		detailTabs
	);

	createTabForSection(
		".product-widget[widget-type='ingredients']",
		translationsStrings.ingredientsTitle[activeLang],
		false,
		detailTabs
	);
	createTabForSection("table.ingredients", translationsStrings.ingredientsTitle[activeLang], true, detailTabs);

	createTabForSection(".natios-analysis", translationsStrings.certificatesTitle[activeLang], true, detailTabs);
	createTabForSection("#ratingTab", translationsStrings.reviewsTitle[activeLang], false, detailTabs);
	createTabForSection(".natios-support-wrapper", translationsStrings.weSupportTitle[activeLang], false, detailTabs);
	createTabForSection(".products-related", translationsStrings.relatedProductsTitle[activeLang], false, detailTabs);

	function createTabForSection(sectionId, tabTitle, isHardcoded, detailTabs) {
		const section = document.querySelector(sectionId);
		if (!section) {
			console.warn(`Section with ID ${sectionId} not found.`);
			return;
		}

		const tab = document.createElement("li");
		tab.className = "shp-tab";

		let tabTitleText = tabTitle;

		if (!isHardcoded) {
			tabTitleText = section.querySelector("h2")
				? section.querySelector("h2").textContent.trim()
				: section.querySelector("h3")
				? section.querySelector("h3").textContent.trim()
				: section.querySelector("h4")
				? section.querySelector("h4").textContent.trim()
				: tabTitle;
		}

		tab.innerHTML = `<span class="shp-tab-link" data-tab="${sectionId}">${tabTitleText}</span>`;

		if (sectionId === "#ratingTab") {
			try {
				let numberOfReviews = section.querySelector(".stars-label").textContent.trim().match(/^\d+/)?.[0];
				tab.innerHTML = `<span class="shp-tab-link" data-tab="${sectionId}">${tabTitleText}<span class="number-of-reviews">${numberOfReviews}</span></span>`;
			} catch (error) {
				console.warn("Error parsing number of reviews:", error);
			}
		}
		detailTabs.appendChild(tab);

		tab.addEventListener("click", function () {
			const activeShopTab = document.querySelector(".shp-tab.active");
			if (activeShopTab && activeShopTab !== tab) {
				activeShopTab.classList.remove("active");
			}
			scrollToElement(section);
		});

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						const activeShopTab = document.querySelector(".shp-tab.active");
						if (activeShopTab) {
							activeShopTab.classList.remove("active");
						}
						tab.classList.add("active");
					}
				});
			},
			{ root: null, threshold: 0.01 } // Trigger when 1% of the section is visible
		);
		observer.observe(section);
	}
}

function productThumbnailInNavigation() {
	let navigaceProduktu = document.querySelector(".shp-tabs-row");
	let productMainImage = document.querySelector(".p-image-wrapper .p-main-image");
	let productName = document.querySelector("h1");
	let productPrice = document.querySelector(".product-top .price-final-holder");

	if (!navigaceProduktu || !productMainImage || !productName || !productPrice) {
		console.warn("Product main image, name, or price not found.");
		return; // Exit if any of the elements are not found
	}

	const shopTapRowWrapper = document.createElement("div");
	shopTapRowWrapper.className = "shop-tap-row-wrapper";
	navigaceProduktu.parentNode.insertBefore(shopTapRowWrapper, navigaceProduktu);
	shopTapRowWrapper.appendChild(navigaceProduktu);

	const productThumbnailButton = document.createElement("div");

	let isAvailableProduct = false;
	if (document.querySelector(".product-top .add-to-cart-button")) {
		isAvailableProduct = true;
	}
	if (isAvailableProduct) {
		productThumbnailButton.className = "product-thumbnail-add-to-cart-button";
		productThumbnailButton.textContent = translationsStrings.toCart[activeLang];
	}

	if (!isAvailableProduct) {
		productThumbnailButton.className = "product-thumbnail-notice-me-button";
		productThumbnailButton.textContent = translationsStrings.alertMe[activeLang];
	}

	const productThumbnail = document.createElement("div");
	productThumbnail.className = "product-thumbnail";

	productThumbnail.innerHTML = `
			<div class="product-thumbnail-image-wrapper">
				${productMainImage.innerHTML}
			</div>
			<div class="product-thumbnail-info-wrapper">
				<div class="product-thumbnail-name">
					${productName.innerHTML}
				</div>
				<div class="product-thumbnail-price-button-wrapper">
					<div class="product-thumbnail-price">
						${productPrice.innerHTML}
						</div>
					<div class="product-thumbnail-buttons">
						${productThumbnailButton.outerHTML}
					</div>
				</div>
			</div>
		`;

	navigaceProduktu.prepend(productThumbnail);
	if (isAvailableProduct) {
		document.querySelector(".product-thumbnail-add-to-cart-button").addEventListener("click", function () {
			shoptet.cartShared.addToCart({ productCode: productCodeValue });
		});
	}
	if (!isAvailableProduct) {
		if (watchdog) {
			document.querySelector(".product-thumbnail-notice-me-button").addEventListener("click", function () {
				watchdog.click();
			});
		}
	}
}

if (body.classList.contains("type-product")) {
	document.addEventListener("DOMContentLoaded", function () {
		productNavigationCustom();
		productThumbnailInNavigation();
	});
}


  // From: js/3_pages/thank_you.js
if (body.classList.contains("id--15")) {
	thxOrder();
}

function thxOrder() {
	let thxElement = document.querySelector(".summary-thx");
	if (!thxElement) return;

	let h1Element = document.querySelector("h1");
	if (h1Element) {
		h1Element.insertAdjacentElement("beforebegin", thxElement);
	}
}


})();
